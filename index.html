<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Web</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* –°–ë–†–û–° –ò –ë–ê–ó–û–í–´–ï –°–¢–ò–õ–ò */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: #0e1621;
            color: #fff;
            height: 100vh;
            overflow: hidden;
        }

        /* –ì–õ–ê–í–ù–´–ô –ö–û–ù–¢–ï–ô–ù–ï–† */
        .app-container {
            display: flex;
            height: 100vh;
            position: relative;
        }

        /* –õ–ï–í–´–ô –ë–û–ö–û–í–û–ô –ë–ê–† - –ú–ï–ù–Æ */
        .left-menu {
            width: 70px;
            background: #182533;
            border-right: 1px solid #2d3b4d;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px 0;
            gap: 25px;
            z-index: 10;
        }

        .menu-item {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #8a8a8a;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }

        .menu-item:hover {
            background: #2a3b52;
            color: #fff;
        }

        .menu-item.active {
            background: #2b5278;
            color: #fff;
        }

        .menu-item .badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #0088cc;
            color: white;
            font-size: 11px;
            padding: 2px 5px;
            border-radius: 10px;
            min-width: 18px;
            text-align: center;
        }

        /* –°–ê–ô–î–ë–ê–† –° –ß–ê–¢–ê–ú–ò */
        .sidebar {
            width: 350px;
            background: #182533;
            border-right: 1px solid #2d3b4d;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s;
        }

        /* –®–ê–ü–ö–ê –°–ê–ô–î–ë–ê–†–ê */
        .sidebar-header {
            padding: 15px 20px;
            border-bottom: 1px solid #2d3b4d;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 16px;
            position: relative;
        }

        .user-status {
            position: absolute;
            bottom: 0;
            right: 0;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #4CAF50;
            border: 2px solid #182533;
        }

        .user-info {
            flex: 1;
        }

        .user-name {
            font-weight: 600;
            font-size: 15px;
        }

        .user-online {
            font-size: 13px;
            color: #8a8a8a;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* –ü–û–ò–°–ö */
        .search-container {
            padding: 15px 20px;
            border-bottom: 1px solid #2d3b4d;
        }

        .search-box {
            background: #0e1621;
            border-radius: 8px;
            padding: 8px 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .search-input {
            background: none;
            border: none;
            color: #fff;
            flex: 1;
            font-size: 14px;
            outline: none;
        }

        /* –°–ü–ò–°–û–ö –ß–ê–¢–û–í */
        .chat-list {
            flex: 1;
            overflow-y: auto;
            padding-bottom: 20px;
        }

        .chat-item {
            padding: 12px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            border-bottom: 1px solid #2d3b4d;
            transition: background 0.2s;
            position: relative;
        }

        .chat-item:hover {
            background: #2a3b52;
        }

        .chat-item.active {
            background: #2b5278;
        }

        .chat-avatar {
            position: relative;
        }

        .chat-avatar-img {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: linear-gradient(135deg, #4CAF50, #8BC34A);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
        }

        .chat-status {
            position: absolute;
            bottom: 0;
            right: 0;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: #4CAF50;
            border: 2px solid #182533;
        }

        .chat-info {
            flex: 1;
            min-width: 0;
        }

        .chat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 4px;
        }

        .chat-name {
            font-weight: 600;
            font-size: 15px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .chat-time {
            font-size: 12px;
            color: #8a8a8a;
        }

        .chat-preview {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 14px;
            color: #8a8a8a;
        }

        .chat-preview-text {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            flex: 1;
        }

        .chat-unread {
            background: #0088cc;
            color: white;
            font-size: 12px;
            padding: 2px 6px;
            border-radius: 10px;
            min-width: 20px;
            text-align: center;
        }

        /* –û–°–ù–û–í–ù–û–ô –ß–ê–¢ */
        .main-chat {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #0e1621;
        }

        /* –®–ê–ü–ö–ê –ß–ê–¢–ê */
        .chat-header-main {
            padding: 15px 20px;
            border-bottom: 1px solid #2d3b4d;
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: #182533;
        }

        .chat-contact {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .chat-contact-info {
            display: flex;
            flex-direction: column;
        }

        .chat-contact-name {
            font-weight: 600;
            font-size: 16px;
        }

        .chat-contact-status {
            font-size: 13px;
            color: #8a8a8a;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .online-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #4CAF50;
        }

        .chat-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .chat-action-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: #8a8a8a;
            font-size: 18px;
            transition: all 0.2s;
        }

        .chat-action-btn:hover {
            background: #2a3b52;
            color: #fff;
        }

        /* –°–û–û–ë–©–ï–ù–ò–Ø */
        .messages-container {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 10px;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" opacity="0.05"><path d="M0,0 L100,100" stroke="gray" stroke-width="1"/><path d="M100,0 L0,100" stroke="gray" stroke-width="1"/></svg>');
            background-size: 100px 100px;
        }

        .message-date {
            text-align: center;
            margin: 20px 0;
        }

        .date-label {
            background: #182533;
            padding: 5px 15px;
            border-radius: 12px;
            font-size: 13px;
            color: #8a8a8a;
            display: inline-block;
        }

        .message {
            max-width: 70%;
            margin-bottom: 10px;
            animation: messageAppear 0.2s ease-out;
        }

        @keyframes messageAppear {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.outgoing {
            align-self: flex-end;
        }

        .message.incoming {
            align-self: flex-start;
        }

        .message-bubble {
            padding: 10px 15px;
            border-radius: 12px;
            position: relative;
            word-wrap: break-word;
            line-height: 1.4;
        }

        .message.outgoing .message-bubble {
            background: #2b5278;
            border-bottom-right-radius: 5px;
        }

        .message.incoming .message-bubble {
            background: #182533;
            border-bottom-left-radius: 5px;
        }

        .message-time {
            font-size: 11px;
            color: #8a8a8a;
            margin-top: 5px;
            display: flex;
            justify-content: flex-end;
            align-items: center;
            gap: 5px;
        }

        /* –í–í–û–î –°–û–û–ë–©–ï–ù–ò–ô */
        .message-input-container {
            padding: 15px 20px;
            border-top: 1px solid #2d3b4d;
            display: flex;
            align-items: center;
            gap: 15px;
            background: #182533;
        }

        .input-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .input-action-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: #8a8a8a;
            font-size: 20px;
            transition: all 0.2s;
        }

        .input-action-btn:hover {
            background: #2a3b52;
            color: #fff;
        }

        .message-input-wrapper {
            flex: 1;
            background: #0e1621;
            border-radius: 25px;
            padding: 10px 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .message-input {
            flex: 1;
            background: none;
            border: none;
            color: #fff;
            font-size: 15px;
            resize: none;
            max-height: 120px;
            min-height: 20px;
            padding: 5px 0;
            outline: none;
            font-family: inherit;
        }

        .send-button {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #0088cc;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: none;
            font-size: 18px;
            transition: background 0.2s;
        }

        .send-button:hover {
            background: #0077b3;
        }

        /* –í–ò–î–ï–û–ó–í–û–ù–û–ö */
        .call-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #000;
            z-index: 1000;
            display: none;
            flex-direction: column;
        }

        .call-overlay.active {
            display: flex;
        }

        .call-container {
            flex: 1;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .remote-video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            background: #111;
        }

        .local-video {
            position: absolute;
            bottom: 20px;
            right: 20px;
            width: 200px;
            height: 150px;
            border-radius: 10px;
            border: 2px solid #fff;
            object-fit: cover;
            background: #333;
        }

        .call-info {
            position: absolute;
            top: 20px;
            left: 20px;
            color: white;
            z-index: 10;
        }

        .call-name {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .call-status {
            font-size: 14px;
            color: #ccc;
        }

        .call-controls {
            position: absolute;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 20px;
            z-index: 10;
        }

        .call-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            backdrop-filter: blur(10px);
        }

        .call-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }

        .call-btn.end-call {
            background: #ff3b30;
        }

        .call-btn.end-call:hover {
            background: #ff1f1f;
        }

        .call-btn.muted {
            background: #ff3b30;
        }

        /* –ù–ê–°–¢–†–û–ô–ö–ò */
        .settings-panel {
            position: fixed;
            top: 0;
            right: -400px;
            width: 400px;
            height: 100%;
            background: #182533;
            border-left: 1px solid #2d3b4d;
            transition: right 0.3s;
            z-index: 100;
            overflow-y: auto;
        }

        .settings-panel.active {
            right: 0;
        }

        .settings-header {
            padding: 20px;
            border-bottom: 1px solid #2d3b4d;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .settings-title {
            font-size: 18px;
            font-weight: 600;
        }

        .settings-close {
            cursor: pointer;
            color: #8a8a8a;
            font-size: 24px;
        }

        .settings-content {
            padding: 20px;
        }

        .settings-section {
            margin-bottom: 30px;
        }

        .settings-section-title {
            font-size: 14px;
            color: #8a8a8a;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .setting-item {
            padding: 15px;
            background: #0e1621;
            border-radius: 10px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .setting-item:hover {
            background: #2a3b52;
        }

        .setting-label {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .setting-desc {
            font-size: 13px;
            color: #8a8a8a;
        }

        /* –ú–û–ë–ò–õ–¨–ù–ê–Ø –í–ï–†–°–ò–Ø */
        @media (max-width: 768px) {
            .left-menu {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                top: auto;
                width: 100%;
                height: 60px;
                flex-direction: row;
                justify-content: space-around;
                padding: 0;
                border-top: 1px solid #2d3b4d;
                z-index: 50;
            }

            .sidebar {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                z-index: 40;
                transform: translateX(-100%);
            }

            .sidebar.active {
                transform: translateX(0);
            }

            .main-chat {
                width: 100%;
            }

            .chat-action-btn {
                width: 44px;
                height: 44px;
                font-size: 20px;
            }

            .local-video {
                width: 120px;
                height: 90px;
                bottom: 100px;
                right: 10px;
            }

            .settings-panel {
                width: 100%;
                right: -100%;
            }

            .call-controls {
                bottom: 80px;
            }

            .mobile-menu-btn {
                display: flex;
            }
        }

        /* –ö–ù–û–ü–ö–ê –ú–ï–ù–Æ –î–õ–Ø –ú–û–ë–ò–õ–¨–ù–û–ô –í–ï–†–°–ò–ò */
        .mobile-menu-btn {
            display: none;
            position: fixed;
            top: 15px;
            left: 15px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #2b5278;
            color: white;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            cursor: pointer;
            z-index: 60;
        }

        @media (max-width: 768px) {
            .mobile-menu-btn {
                display: flex;
            }
        }

        /* –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #182533;
            border: 1px solid #2d3b4d;
            border-radius: 10px;
            padding: 15px;
            max-width: 300px;
            z-index: 1000;
            animation: slideIn 0.3s ease-out;
            display: none;
        }

        .notification.active {
            display: block;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .notification-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .notification-title {
            font-weight: 600;
        }

        .notification-body {
            font-size: 14px;
            color: #8a8a8a;
        }

        .notification-close {
            cursor: pointer;
            color: #8a8a8a;
        }

        /* –ö–ê–ù–ê–õ–´ */
        .channel-item {
            padding: 12px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            border-bottom: 1px solid #2d3b4d;
        }

        .channel-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: linear-gradient(135deg, #FF5722, #FF9800);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
        }

        /* –°–ö–†–´–¢–´–ï –≠–õ–ï–ú–ï–ù–¢–´ */
        .hidden {
            display: none !important;
        }

        /* –ó–ê–ì–†–£–ó–ö–ê */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background: #0e1621;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid #2b5278;
            border-top: 3px solid #0088cc;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- –ó–ê–ì–†–£–ó–ö–ê -->
    <div class="loading" id="loading">
        <div class="spinner"></div>
    </div>

    <!-- –ì–õ–ê–í–ù–´–ô –ö–û–ù–¢–ï–ô–ù–ï–† -->
    <div class="app-container hidden" id="appContainer">
        <!-- –õ–ï–í–û–ï –ú–ï–ù–Æ -->
        <div class="left-menu">
            <div class="menu-item active" title="–ß–∞—Ç—ã" onclick="showChats()">
                <i class="fas fa-comment-alt"></i>
                <span class="badge" id="unreadBadge">3</span>
            </div>
            <div class="menu-item" title="–ö–∞–Ω–∞–ª—ã" onclick="showChannels()">
                <i class="fas fa-broadcast-tower"></i>
                <span class="badge" id="channelBadge">42</span>
            </div>
            <div class="menu-item" title="–ù–∞—Å—Ç—Ä–æ–π–∫–∏" onclick="showSettings()">
                <i class="fas fa-cog"></i>
            </div>
            <div class="menu-item" title="–ü–æ–¥–¥–µ—Ä–∂–∫–∞" onclick="showSupport()">
                <i class="fas fa-headset"></i>
            </div>
        </div>

        <!-- –ö–ù–û–ü–ö–ê –ú–ï–ù–Æ –î–õ–Ø –ú–û–ë–ò–õ–¨–ù–û–ö -->
        <div class="mobile-menu-btn" onclick="toggleSidebar()">
            <i class="fas fa-bars"></i>
        </div>

        <!-- –°–ê–ô–î–ë–ê–† –° –ß–ê–¢–ê–ú–ò -->
        <div class="sidebar" id="sidebar">
            <!-- –®–ê–ü–ö–ê –°–ê–ô–î–ë–ê–†–ê -->
            <div class="sidebar-header">
                <div class="user-profile" onclick="showProfile()">
                    <div class="user-avatar" id="userAvatar">
                        TM
                        <div class="user-status"></div>
                    </div>
                    <div class="user-info">
                        <div class="user-name" id="userName">–¢–∏—Ö–æ–Ω –ú–µ—Ç–µ–ª–∫–∏–Ω</div>
                        <div class="user-online">
                            <i class="fas fa-circle" style="color: #4CAF50; font-size: 8px;"></i>
                            –æ–Ω–ª–∞–π–Ω
                        </div>
                    </div>
                </div>
                <div class="chat-action-btn" title="–ù–æ–≤—ã–π —á–∞—Ç" onclick="startNewChat()">
                    <i class="fas fa-edit"></i>
                </div>
            </div>

            <!-- –ü–û–ò–°–ö -->
            <div class="search-container">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" class="search-input" placeholder="–ü–æ–∏—Å–∫" id="searchInput" oninput="searchChats()">
                </div>
            </div>

            <!-- –°–ü–ò–°–û–ö –ß–ê–¢–û–í -->
            <div class="chat-list" id="chatList">
                <!-- –ß–ê–¢–´ –ë–£–î–£–¢ –î–û–ë–ê–í–õ–Ø–¢–¨–°–Ø –ó–î–ï–°–¨ -->
            </div>

            <!-- –ö–ê–ù–ê–õ–´ (—Å–∫—Ä—ã—Ç–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) -->
            <div class="chat-list hidden" id="channelList">
                <!-- –ö–ê–ù–ê–õ–´ –ë–£–î–£–¢ –î–û–ë–ê–í–õ–Ø–¢–¨–°–Ø –ó–î–ï–°–¨ -->
            </div>
        </div>

        <!-- –û–°–ù–û–í–ù–û–ô –ß–ê–¢ -->
        <div class="main-chat">
            <!-- –®–ê–ü–ö–ê –ß–ê–¢–ê -->
            <div class="chat-header-main">
                <div class="chat-contact">
                    <div class="user-avatar" id="currentChatAvatar">
                        –ê
                    </div>
                    <div class="chat-contact-info">
                        <div class="chat-contact-name" id="currentChatName">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</div>
                        <div class="chat-contact-status" id="currentChatStatus">
                            <span class="online-indicator"></span>
                            –≤ —Å–µ—Ç–∏
                        </div>
                    </div>
                </div>
                <div class="chat-actions">
                    <div class="chat-action-btn" title="–ü–æ–∏—Å–∫" onclick="searchInChat()">
                        <i class="fas fa-search"></i>
                    </div>
                    <div class="chat-action-btn" title="–í–∏–¥–µ–æ–∑–≤–æ–Ω–æ–∫" onclick="startVideoCall()">
                        <i class="fas fa-video"></i>
                    </div>
                    <div class="chat-action-btn" title="–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è" onclick="showChatInfo()">
                        <i class="fas fa-info-circle"></i>
                    </div>
                </div>
            </div>

            <!-- –°–û–û–ë–©–ï–ù–ò–Ø -->
            <div class="messages-container" id="messagesContainer">
                <div class="message-date">
                    <span class="date-label">–°–µ–≥–æ–¥–Ω—è</span>
                </div>
                <!-- –°–û–û–ë–©–ï–ù–ò–Ø –ë–£–î–£–¢ –î–û–ë–ê–í–õ–Ø–¢–¨–°–Ø –ó–î–ï–°–¨ -->
            </div>

            <!-- –í–í–û–î –°–û–û–ë–©–ï–ù–ò–ô -->
            <div class="message-input-container">
                <div class="input-actions">
                    <div class="input-action-btn" title="–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å —Ñ–∞–π–ª" onclick="attachFile()">
                        <i class="fas fa-paperclip"></i>
                    </div>
                </div>
                <div class="message-input-wrapper">
                    <textarea class="message-input" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ" rows="1" id="messageInput"></textarea>
                    <div class="input-action-btn" title="–°–º–∞–π–ª–∏–∫–∏" onclick="showEmoji()">
                        <i class="far fa-smile"></i>
                    </div>
                </div>
                <button class="send-button" title="–û—Ç–ø—Ä–∞–≤–∏—Ç—å" onclick="sendMessage()">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- –í–ò–î–ï–û–ó–í–û–ù–û–ö -->
    <div class="call-overlay" id="callOverlay">
        <div class="call-container">
            <div class="call-info">
                <div class="call-name" id="callContactName">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</div>
                <div class="call-status" id="callStatus">–£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è...</div>
            </div>
            <video class="remote-video" id="remoteVideo" autoplay playsinline></video>
            <video class="local-video" id="localVideo" autoplay playsinline muted></video>
            <div class="call-controls">
                <button class="call-btn" id="toggleAudioBtn" onclick="toggleAudio()">
                    <i class="fas fa-microphone"></i>
                </button>
                <button class="call-btn" id="toggleVideoBtn" onclick="toggleVideo()">
                    <i class="fas fa-video"></i>
                </button>
                <button class="call-btn end-call" onclick="endCall()">
                    <i class="fas fa-phone-slash"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- –ü–ê–ù–ï–õ–¨ –ù–ê–°–¢–†–û–ï–ö -->
    <div class="settings-panel" id="settingsPanel">
        <div class="settings-header">
            <div class="settings-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>
            <div class="settings-close" onclick="hideSettings()">√ó</div>
        </div>
        <div class="settings-content">
            <div class="settings-section">
                <div class="settings-section-title">–ê–∫–∫–∞—É–Ω—Ç</div>
                <div class="setting-item" onclick="editProfile()">
                    <div class="setting-label">–ò–∑–º–µ–Ω–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</div>
                    <div class="setting-desc">–ò–º—è, —Ñ–æ—Ç–æ, —Å—Ç–∞—Ç—É—Å</div>
                </div>
                <div class="setting-item" onclick="changePassword()">
                    <div class="setting-label">–ò–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å</div>
                    <div class="setting-desc">–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç–∞</div>
                </div>
            </div>
            
            <div class="settings-section">
                <div class="settings-section-title">–ü—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å</div>
                <div class="setting-item" onclick="privacySettings()">
                    <div class="setting-label">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏</div>
                    <div class="setting-desc">–ö—Ç–æ –º–æ–∂–µ—Ç –≤–∞—Å –Ω–∞–π—Ç–∏</div>
                </div>
                <div class="setting-item" onclick="blockedUsers()">
                    <div class="setting-label">–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ</div>
                    <div class="setting-desc">–°–ø–∏—Å–æ–∫ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö</div>
                </div>
            </div>
            
            <div class="settings-section">
                <div class="settings-section-title">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</div>
                <div class="setting-item" onclick="notificationSettings()">
                    <div class="setting-label">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</div>
                    <div class="setting-desc">–ó–≤—É–∫–∏, –≤–∏–±—Ä–∞—Ü–∏–∏</div>
                </div>
            </div>
            
            <div class="settings-section">
                <div class="settings-section-title">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ</div>
                <div class="setting-item" onclick="dataStorage()">
                    <div class="setting-label">–•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö</div>
                    <div class="setting-desc">–ö—ç—à, –º–µ–¥–∏–∞—Ñ–∞–π–ª—ã</div>
                </div>
                <div class="setting-item" onclick="aboutApp()">
                    <div class="setting-label">–û –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏</div>
                    <div class="setting-desc">–í–µ—Ä—Å–∏—è, –ª–∏—Ü–µ–Ω–∑–∏—è</div>
                </div>
            </div>
            
            <div class="settings-section">
                <div class="setting-item" onclick="logout()" style="background: #ff3b30; color: white;">
                    <div class="setting-label">–í—ã–π—Ç–∏</div>
                    <div class="setting-desc">–ó–∞–≤–µ—Ä—à–∏—Ç—å —Å–µ–∞–Ω—Å</div>
                </div>
            </div>
        </div>
    </div>

    <!-- –£–í–ï–î–û–ú–õ–ï–ù–ò–ï -->
    <div class="notification" id="notification">
        <div class="notification-header">
            <div class="notification-title" id="notificationTitle">Telegram</div>
            <div class="notification-close" onclick="hideNotification()">√ó</div>
        </div>
        <div class="notification-body" id="notificationBody">–°–æ–æ–±—â–µ–Ω–∏–µ</div>
    </div>

    <!-- –°–ö–†–ò–ü–¢–´ -->
    <script>
        // ==================== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï ====================
        let currentUser = {
            id: 'tihon_metelkin',
            name: '–¢–∏—Ö–æ–Ω –ú–µ—Ç–µ–ª–∫–∏–Ω',
            avatar: 'TM',
            status: 'online',
            deviceId: generateDeviceId()
        };

        let currentChat = null;
        let chats = [];
        let channels = [];
        let socket = null;
        let peerConnection = null;
        let localStream = null;
        let remoteStream = null;
        let isCallActive = false;
        let isAudioMuted = false;
        let isVideoOff = false;

        // ==================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ====================
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('appContainer').classList.remove('hidden');
                initializeApp();
            }, 1000);
        });

        function initializeApp() {
            loadUserData();
            initializeChats();
            initializeChannels();
            connectToServer();
            setupEventListeners();
            showNotification('–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Telegram Web!', 'info');
        }

        function generateDeviceId() {
            return 'device_' + Math.random().toString(36).substr(2, 9) + '_' + Date.now();
        }

        function loadUserData() {
            const savedUser = localStorage.getItem('telegram_user');
            if (savedUser) {
                try {
                    const userData = JSON.parse(savedUser);
                    currentUser = { ...currentUser, ...userData };
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', e);
                }
            }
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º deviceId –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
            if (!currentUser.deviceId) {
                currentUser.deviceId = generateDeviceId();
            }
            
            saveUserData();
            updateUserUI();
        }

        function saveUserData() {
            localStorage.setItem('telegram_user', JSON.stringify(currentUser));
        }

        function updateUserUI() {
            document.getElementById('userName').textContent = currentUser.name;
            document.getElementById('userAvatar').innerHTML = currentUser.avatar;
        }

        // ==================== –ß–ê–¢–´ ====================
        function initializeChats() {
            chats = [
                {
                    id: 'admin',
                    name: '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä',
                    avatar: '–ê',
                    status: 'online',
                    lastMessage: '–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Telegram Web!',
                    time: '12:00',
                    unread: 1,
                    messages: [
                        { id: '1', type: 'incoming', text: 'üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Telegram Web!', time: '12:00', read: true },
                        { id: '2', type: 'incoming', text: '–≠—Ç–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—á–∏–π –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä —Å –≤–∏–¥–µ–æ–∑–≤–æ–Ω–∫–∞–º–∏.', time: '12:01', read: true },
                        { id: '3', type: 'incoming', text: '–í—ã –º–æ–∂–µ—Ç–µ –æ–±—â–∞—Ç—å—Å—è –º–µ–∂–¥—É —Å–≤–æ–∏–º–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.', time: '12:02', read: true }
                    ]
                },
                {
                    id: 'olga_metelkina',
                    name: '–û–ª—å–≥–∞ –ú–µ—Ç–µ–ª–∫–∏–Ω–∞',
                    avatar: '–û–ú',
                    status: 'online',
                    lastMessage: '–ü—Ä–∏–≤–µ—Ç! –ö–∞–∫ –¥–µ–ª–∞?',
                    time: '15:30',
                    unread: 0,
                    messages: [
                        { id: '1', type: 'incoming', text: '–ü—Ä–∏–≤–µ—Ç! –ö–∞–∫ –¥–µ–ª–∞?', time: '15:30', read: true },
                        { id: '2', type: 'outgoing', text: '–ü—Ä–∏–≤–µ—Ç! –í—Å—ë –æ—Ç–ª–∏—á–Ω–æ, —Ä–∞–±–æ—Ç–∞—é –Ω–∞–¥ –Ω–æ–≤—ã–º –ø—Ä–æ–µ–∫—Ç–æ–º.', time: '15:32', read: true }
                    ]
                },
                {
                    id: 'pavel_vilkov',
                    name: '–ü–∞–≤–µ–ª –í–∏–ª–∫–æ–≤',
                    avatar: '–ü–í',
                    status: 'offline',
                    lastMessage: '–í—Å—Ç—Ä–µ—á–∞–µ–º—Å—è –≤ 18:00',
                    time: '–í—á–µ—Ä–∞',
                    unread: 3,
                    messages: [
                        { id: '1', type: 'incoming', text: '–ü—Ä–∏–≤–µ—Ç! –í—Å—Ç—Ä–µ—á–∞–µ–º—Å—è –≤ 18:00', time: '–í—á–µ—Ä–∞ 17:45', read: false },
                        { id: '2', type: 'outgoing', text: '–û–∫, –±—É–¥—É!', time: '–í—á–µ—Ä–∞ 17:46', read: true }
                    ]
                },
                {
                    id: 'device2',
                    name: '–ú–æ–π —Ç–µ–ª–µ—Ñ–æ–Ω',
                    avatar: 'üì±',
                    status: 'online',
                    lastMessage: '–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ',
                    time: '10:15',
                    unread: 0,
                    messages: [
                        { id: '1', type: 'system', text: 'üì± –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ', time: '10:15', read: true }
                    ]
                }
            ];

            renderChats();
            if (chats.length > 0) {
                selectChat(chats[0].id);
            }
        }

        function initializeChannels() {
            channels = [
                {
                    id: 'brat2',
                    name: '–ë—Ä–∞—Ç 2',
                    avatar: '–ë2',
                    subscribers: 12500,
                    lastMessage: '–ö–ê–ö –¢–ê–ú –í–ê–®–ò –°–¢–ê–í–ö–ò –ù–ê –ö–õ–£...',
                    time: '10:15',
                    unread: 42
                },
                {
                    id: 'par',
                    name: '–ü–∞—Ä',
                    avatar: '–ü',
                    subscribers: 8900,
                    lastMessage: '–ü–∞—Ä —Ç–µ–ø–µ—Ä—å –≤ Telegram',
                    time: '–°—Ä',
                    unread: 0
                },
                {
                    id: 'mama',
                    name: '–ú–∞–º–∞',
                    avatar: 'üë©',
                    subscribers: 1,
                    lastMessage: '–í—Å–µ —Ñ–∞–π–ª—ã –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ',
                    time: '–ü–Ω',
                    unread: 0
                },
                {
                    id: 'black_river',
                    name: '–ß–µ—Ä–Ω–∞—è –†–µ—á–∫–∞ –ö–≤',
                    avatar: 'üè†',
                    subscribers: 150,
                    lastMessage: '–ß–µ—Ä–Ω–∞—è –†–µ—á–∫–∞ –ö–≤ —Ç–µ–ø–µ—Ä—å –≤ Telegram',
                    time: '25 –¥–µ–∫',
                    unread: 0
                }
            ];

            renderChannels();
        }

        function renderChats() {
            const chatList = document.getElementById('chatList');
            chatList.innerHTML = '';

            chats.forEach(chat => {
                const chatItem = document.createElement('div');
                chatItem.className = 'chat-item';
                if (currentChat && chat.id === currentChat.id) {
                    chatItem.classList.add('active');
                }

                const statusColor = chat.status === 'online' ? '#4CAF50' : '#8a8a8a';
                
                chatItem.innerHTML = `
                    <div class="chat-avatar">
                        <div class="chat-avatar-img">${chat.avatar}</div>
                        ${chat.status === 'online' ? '<div class="chat-status"></div>' : ''}
                    </div>
                    <div class="chat-info">
                        <div class="chat-header">
                            <div class="chat-name">${chat.name}</div>
                            <div class="chat-time">${chat.time}</div>
                        </div>
                        <div class="chat-preview">
                            <div class="chat-preview-text">${chat.lastMessage}</div>
                            ${chat.unread > 0 ? `<div class="chat-unread">${chat.unread}</div>` : ''}
                        </div>
                    </div>
                `;

                chatItem.onclick = () => selectChat(chat.id);
                chatList.appendChild(chatItem);
            });

            updateUnreadBadge();
        }

        function renderChannels() {
            const channelList = document.getElementById('channelList');
            channelList.innerHTML = '';

            channels.forEach(channel => {
                const channelItem = document.createElement('div');
                channelItem.className = 'channel-item';
                
                channelItem.innerHTML = `
                    <div class="channel-avatar">${channel.avatar}</div>
                    <div class="chat-info">
                        <div class="chat-header">
                            <div class="chat-name">${channel.name}</div>
                            <div class="chat-time">${channel.time}</div>
                        </div>
                        <div class="chat-preview">
                            <div class="chat-preview-text">${channel.lastMessage}</div>
                            ${channel.unread > 0 ? `<div class="chat-unread">${channel.unread}</div>` : ''}
                        </div>
                    </div>
                `;

                channelList.appendChild(channelItem);
            });
        }

        function selectChat(chatId) {
            const chat = chats.find(c => c.id === chatId);
            if (!chat) return;

            currentChat = chat;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º UI
            document.getElementById('currentChatName').textContent = chat.name;
            document.getElementById('currentChatAvatar').innerHTML = chat.avatar;
            
            const statusText = chat.status === 'online' ? '–≤ —Å–µ—Ç–∏' : '–±—ã–ª(–∞) –Ω–µ–¥–∞–≤–Ω–æ';
            const statusHtml = chat.status === 'online' 
                ? '<span class="online-indicator"></span> –≤ —Å–µ—Ç–∏'
                : `<span style="color: #8a8a8a;">${statusText}</span>`;
            
            document.getElementById('currentChatStatus').innerHTML = statusHtml;
            document.getElementById('callContactName').textContent = chat.name;

            // –û—Ç–º–µ—á–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ
            chat.unread = 0;
            renderChats();

            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è
            loadMessages(chat.messages);

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            if (chat.messages.some(m => !m.read)) {
                showNotification(`–ù–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —á–∞—Ç–µ —Å ${chat.name}`, 'info');
            }

            // –ù–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö —Å–∫—Ä—ã–≤–∞–µ–º —Å–∞–π–¥–±–∞—Ä
            if (window.innerWidth <= 768) {
                document.getElementById('sidebar').classList.remove('active');
            }
        }

        function loadMessages(messages) {
            const container = document.getElementById('messagesContainer');
            
            // –û—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä, –∫—Ä–æ–º–µ –¥–∞—Ç—ã
            const dateElement = container.querySelector('.message-date');
            container.innerHTML = '';
            if (dateElement) {
                container.appendChild(dateElement);
            }

            // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è
            messages.forEach(msg => {
                addMessageToUI(msg, false);
                if (!msg.read && msg.type === 'incoming') {
                    msg.read = true;
                }
            });

            // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –≤–Ω–∏–∑
            container.scrollTop = container.scrollHeight;
        }

        function addMessageToUI(message, scroll = true) {
            const container = document.getElementById('messagesContainer');
            
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${message.type}`;
            
            let messageHtml = `
                <div class="message-bubble">${message.text}</div>
                <div class="message-time">${message.time}`;
            
            if (message.type === 'outgoing') {
                messageHtml += ` <i class="fas fa-check${message.read ? '-double' : ''}" style="color: ${message.read ? '#4CAF50' : '#8a8a8a'};"></i>`;
            }
            
            messageHtml += `</div>`;
            messageDiv.innerHTML = messageHtml;
            
            container.appendChild(messageDiv);
            
            if (scroll) {
                container.scrollTop = container.scrollHeight;
            }
        }

        // ==================== –°–û–û–ë–©–ï–ù–ò–Ø ====================
        function sendMessage() {
            const input = document.getElementById('messageInput');
            const text = input.value.trim();
            
            if (!text || !currentChat) return;

            // –°–æ–∑–¥–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
            const message = {
                id: 'msg_' + Date.now(),
                type: 'outgoing',
                text: text,
                time: getCurrentTime(),
                read: false
            };

            // –î–æ–±–∞–≤–ª—è–µ–º –≤ UI
            addMessageToUI(message);

            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∏—Å—Ç–æ—Ä–∏—é —á–∞—Ç–∞
            currentChat.messages.push(message);
            currentChat.lastMessage = text;
            currentChat.time = getCurrentTimeShort();
            renderChats();

            // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞
            input.value = '';
            adjustTextareaHeight(input);

            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —á–µ—Ä–µ–∑ WebSocket
            if (socket && socket.readyState === WebSocket.OPEN) {
                const messageData = {
                    type: 'message',
                    from: currentUser.id,
                    to: currentChat.id,
                    text: text,
                    messageId: message.id,
                    timestamp: Date.now()
                };
                socket.send(JSON.stringify(messageData));
            }

            // –°–∏–º—É–ª—è—Ü–∏—è –æ—Ç–≤–µ—Ç–∞ –¥–ª—è –∞–¥–º–∏–Ω–∞
            if (currentChat.id === 'admin') {
                setTimeout(() => {
                    const responses = [
                        '–û—Ç–ª–∏—á–Ω–æ! –†–∞–±–æ—Ç–∞–µ—Ç!',
                        '–°–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—É—á–µ–Ω–æ –Ω–∞ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö',
                        '–í–∏–¥–µ–æ–∑–≤–æ–Ω–æ–∫ —Ç–æ–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –º–µ–∂–¥—É —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏',
                        '–¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –æ–±—â–∞—Ç—å—Å—è —Å —Å–∞–º–∏–º —Å–æ–±–æ–π —Å —Ä–∞–∑–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤'
                    ];
                    const response = responses[Math.floor(Math.random() * responses.length)];
                    
                    const replyMessage = {
                        id: 'reply_' + Date.now(),
                        type: 'incoming',
                        text: response,
                        time: getCurrentTime(),
                        read: false
                    };
                    
                    addMessageToUI(replyMessage);
                    currentChat.messages.push(replyMessage);
                    currentChat.lastMessage = response;
                    currentChat.time = getCurrentTimeShort();
                    currentChat.unread = (currentChat.unread || 0) + 1;
                    renderChats();
                    
                    showNotification(`–ù–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç ${currentChat.name}`, 'info');
                }, 1000 + Math.random() * 2000);
            }
        }

        // ==================== –í–ò–î–ï–û–ó–í–û–ù–ö–ò ====================
        async function startVideoCall() {
            if (!currentChat) {
                showNotification('–í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Ç –¥–ª—è –∑–≤–æ–Ω–∫–∞', 'error');
                return;
            }

            try {
                showNotification('–ó–∞–ø—É—Å–∫ –≤–∏–¥–µ–æ–∑–≤–æ–Ω–∫–∞...', 'info');
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –∑–≤–æ–Ω–∫–∞
                document.getElementById('callOverlay').classList.add('active');
                document.getElementById('callStatus').textContent = '–ó–∞–ø—Ä–æ—Å –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–º–µ—Ä–µ...';

                // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –¥–æ—Å—Ç—É–ø –∫ –º–µ–¥–∏–∞—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º
                localStream = await navigator.mediaDevices.getUserMedia({
                    video: {
                        width: { ideal: 1280 },
                        height: { ideal: 720 },
                        facingMode: 'user'
                    },
                    audio: {
                        echoCancellation: true,
                        noiseSuppression: true,
                        sampleRate: 44100
                    }
                });

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ª–æ–∫–∞–ª—å–Ω–æ–µ –≤–∏–¥–µ–æ
                const localVideo = document.getElementById('localVideo');
                localVideo.srcObject = localStream;

                // –ù–∞—á–∏–Ω–∞–µ–º WebRTC —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
                startWebRTCCall();

                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
                document.getElementById('callStatus').textContent = '–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ';
                isCallActive = true;

                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –∑–≤–æ–Ω–∫–µ
                if (socket && socket.readyState === WebSocket.OPEN) {
                    const callData = {
                        type: 'call',
                        from: currentUser.id,
                        to: currentChat.id,
                        callId: 'call_' + Date.now()
                    };
                    socket.send(JSON.stringify(callData));
                }

                // –°–∏–º—É–ª—è—Ü–∏—è –æ—Ç–≤–µ—Ç–∞ –æ—Ç –¥—Ä—É–≥–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
                setTimeout(() => {
                    if (isCallActive) {
                        simulateRemoteVideo();
                        showNotification(`${currentChat.name} –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª—Å—è –∫ –∑–≤–æ–Ω–∫—É`, 'success');
                    }
                }, 2000);

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–≤–æ–Ω–∫–∞:', error);
                document.getElementById('callStatus').textContent = '–û—à–∏–±–∫–∞: –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–º–µ—Ä–µ';
                showNotification('–†–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ –∏ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É', 'error');
                
                setTimeout(() => {
                    endCall();
                }, 3000);
            }
        }

        function startWebRTCCall() {
            // –°–æ–∑–¥–∞–µ–º PeerConnection
            const configuration = {
                iceServers: [
                    { urls: 'stun:stun.l.google.com:19302' },
                    { urls: 'stun:stun1.l.google.com:19302' },
                    { urls: 'stun:stun2.l.google.com:19302' }
                ]
            };

            peerConnection = new RTCPeerConnection(configuration);

            // –î–æ–±–∞–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–π –ø–æ—Ç–æ–∫
            localStream.getTracks().forEach(track => {
                peerConnection.addTrack(track, localStream);
            });

            // –û–±—Ä–∞–±–æ—Ç–∫–∞ —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–∞
            peerConnection.ontrack = event => {
                const remoteVideo = document.getElementById('remoteVideo');
                remoteStream = event.streams[0];
                remoteVideo.srcObject = remoteStream;
            };

            // ICE –∫–∞–Ω–¥–∏–¥–∞—Ç—ã
            peerConnection.onicecandidate = event => {
                if (event.candidate && socket) {
                    socket.send(JSON.stringify({
                        type: 'ice-candidate',
                        candidate: event.candidate
                    }));
                }
            };

            // –°–æ–∑–¥–∞–µ–º offer
            peerConnection.createOffer()
                .then(offer => peerConnection.setLocalDescription(offer))
                .then(() => {
                    if (socket) {
                        socket.send(JSON.stringify({
                            type: 'offer',
                            offer: peerConnection.localDescription
                        }));
                    }
                })
                .catch(console.error);
        }

        function simulateRemoteVideo() {
            const remoteVideo = document.getElementById('remoteVideo');
            
            // –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤–æ–µ –≤–∏–¥–µ–æ
            const canvas = document.createElement('canvas');
            canvas.width = 640;
            canvas.height = 480;
            const ctx = canvas.getContext('2d');

            // –ê–Ω–∏–º–∞—Ü–∏—è –¥–ª—è –∏–º–∏—Ç–∞—Ü–∏–∏ –≤–∏–¥–µ–æ
            function drawFrame() {
                if (!isCallActive) return;

                // –ì—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–π —Ñ–æ–Ω
                const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
                gradient.addColorStop(0, '#667eea');
                gradient.addColorStop(1, '#764ba2');
                ctx.fillStyle = gradient;
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                // –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                ctx.fillStyle = 'white';
                ctx.font = '48px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(currentChat.avatar, canvas.width/2, canvas.height/2);

                // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º canvas –≤ stream
                const stream = canvas.captureStream(30);
                remoteVideo.srcObject = stream;

                requestAnimationFrame(drawFrame);
            }

            drawFrame();
        }

        function toggleAudio() {
            if (localStream) {
                const audioTrack = localStream.getAudioTracks()[0];
                if (audioTrack) {
                    audioTrack.enabled = !audioTrack.enabled;
                    isAudioMuted = !audioTrack.enabled;
                    
                    const btn = document.getElementById('toggleAudioBtn');
                    if (isAudioMuted) {
                        btn.classList.add('muted');
                        btn.innerHTML = '<i class="fas fa-microphone-slash"></i>';
                        showNotification('–ú–∏–∫—Ä–æ—Ñ–æ–Ω –≤—ã–∫–ª—é—á–µ–Ω', 'info');
                    } else {
                        btn.classList.remove('muted');
                        btn.innerHTML = '<i class="fas fa-microphone"></i>';
                        showNotification('–ú–∏–∫—Ä–æ—Ñ–æ–Ω –≤–∫–ª—é—á–µ–Ω', 'info');
                    }
                }
            }
        }

        function toggleVideo() {
            if (localStream) {
                const videoTrack = localStream.getVideoTracks()[0];
                if (videoTrack) {
                    videoTrack.enabled = !videoTrack.enabled;
                    isVideoOff = !videoTrack.enabled;
                    
                    const btn = document.getElementById('toggleVideoBtn');
                    if (isVideoOff) {
                        btn.classList.add('muted');
                        btn.innerHTML = '<i class="fas fa-video-slash"></i>';
                        showNotification('–ö–∞–º–µ—Ä–∞ –≤—ã–∫–ª—é—á–µ–Ω–∞', 'info');
                    } else {
                        btn.classList.remove('muted');
                        btn.innerHTML = '<i class="fas fa-video"></i>';
                        showNotification('–ö–∞–º–µ—Ä–∞ –≤–∫–ª—é—á–µ–Ω–∞', 'info');
                    }
                }
            }
        }

        function endCall() {
            isCallActive = false;
            
            // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –º–µ–¥–∏–∞–ø–æ—Ç–æ–∫–∏
            if (localStream) {
                localStream.getTracks().forEach(track => track.stop());
                localStream = null;
            }
            
            if (peerConnection) {
                peerConnection.close();
                peerConnection = null;
            }
            
            // –û—á–∏—â–∞–µ–º –≤–∏–¥–µ–æ
            document.getElementById('localVideo').srcObject = null;
            document.getElementById('remoteVideo').srcObject = null;
            
            // –°–∫—Ä—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –∑–≤–æ–Ω–∫–∞
            document.getElementById('callOverlay').classList.remove('active');
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
            isAudioMuted = false;
            isVideoOff = false;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏
            const audioBtn = document.getElementById('toggleAudioBtn');
            const videoBtn = document.getElementById('toggleVideoBtn');
            audioBtn.classList.remove('muted');
            audioBtn.innerHTML = '<i class="fas fa-microphone"></i>';
            videoBtn.classList.remove('muted');
            videoBtn.innerHTML = '<i class="fas fa-video"></i>';
            
            showNotification('–ó–≤–æ–Ω–æ–∫ –∑–∞–≤–µ—Ä—à–µ–Ω', 'info');
        }

        // ==================== WEB SOCKET ====================
        function connectToServer() {
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É
            // –î–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å–∏–º—É–ª—è—Ü–∏—é
            
            showNotification('–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É...', 'info');
            
            // –ò–º–∏—Ç–∞—Ü–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
            setTimeout(() => {
                showNotification('–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ', 'success');
                
                // –ò–º–∏—Ç–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π —Å –¥—Ä—É–≥–∏—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
                setInterval(() => {
                    if (Math.random() > 0.7 && currentChat) {
                        simulateMessageFromOtherDevice();
                    }
                }, 30000);
            }, 2000);
        }

        function simulateMessageFromOtherDevice() {
            if (!currentChat || currentChat.id === 'admin') return;
            
            const messages = [
                '–ü—Ä–∏–≤–µ—Ç! –ö–∞–∫ –¥–µ–ª–∞?',
                '–í–∏–¥–µ–æ–∑–≤–æ–Ω–æ–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ç–ª–∏—á–Ω–æ!',
                '–ü—Ä–æ–≤–µ—Ä—è—é —Å–≤—è–∑—å –º–µ–∂–¥—É —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏',
                '–ú–æ–∂–µ—à—å –ø–æ–∑–≤–æ–Ω–∏—Ç—å –º–Ω–µ?',
                '–°–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—É—á–µ–Ω–æ?'
            ];
            
            const message = messages[Math.floor(Math.random() * messages.length)];
            
            const newMessage = {
                id: 'remote_' + Date.now(),
                type: 'incoming',
                text: message,
                time: getCurrentTime(),
                read: false
            };
            
            // –î–æ–±–∞–≤–ª—è–µ–º –≤ —Ç–µ–∫—É—â–∏–π —á–∞—Ç –µ—Å–ª–∏ –æ–Ω –æ—Ç–∫—Ä—ã—Ç
            if (currentChat.id === 'device2') {
                addMessageToUI(newMessage);
                currentChat.messages.push(newMessage);
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤ —Å–ø–∏—Å–∫–µ —á–∞—Ç–æ–≤
            const chat = chats.find(c => c.id === 'device2');
            if (chat) {
                chat.lastMessage = message;
                chat.time = getCurrentTimeShort();
                chat.unread = (chat.unread || 0) + 1;
                renderChats();
                showNotification('–ù–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –¥—Ä—É–≥–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞', 'info');
            }
        }

        // ==================== UI –£–¢–ò–õ–ò–¢–´ ====================
        function showChats() {
            document.getElementById('chatList').classList.remove('hidden');
            document.getElementById('channelList').classList.add('hidden');
            updateMenuActive('chats');
        }

        function showChannels() {
            document.getElementById('chatList').classList.add('hidden');
            document.getElementById('channelList').classList.remove('hidden');
            updateMenuActive('channels');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –±–µ–π–¥–∂ –∫–∞–Ω–∞–ª–æ–≤
            const totalUnread = channels.reduce((sum, channel) => sum + channel.unread, 0);
            document.getElementById('channelBadge').textContent = totalUnread;
        }

        function showSettings() {
            document.getElementById('settingsPanel').classList.add('active');
            updateMenuActive('settings');
        }

        function hideSettings() {
            document.getElementById('settingsPanel').classList.remove('active');
        }

        function showSupport() {
            selectChat('admin');
            showNotification('–û—Ç–∫—Ä—ã—Ç —á–∞—Ç —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π', 'info');
        }

        function showProfile() {
            showNotification('–ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è', 'info');
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –æ—Ç–∫—Ä—ã—Ç–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
        }

        function updateMenuActive(activeItem) {
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
            });
            
            const items = {
                'chats': 0,
                'channels': 1,
                'settings': 2,
                'support': 3
            };
            
            if (items[activeItem] !== undefined) {
                document.querySelectorAll('.menu-item')[items[activeItem]].classList.add('active');
            }
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('active');
        }

        function searchChats() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            const chatItems = document.querySelectorAll('.chat-item');
            
            chatItems.forEach(item => {
                const chatName = item.querySelector('.chat-name').textContent.toLowerCase();
                if (chatName.includes(query)) {
                    item.style.display = 'flex';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        function searchInChat() {
            showNotification('–ü–æ–∏—Å–∫ –ø–æ —Å–æ–æ–±—â–µ–Ω–∏—è–º', 'info');
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –ø–æ–∏—Å–∫
        }

        function showChatInfo() {
            if (currentChat) {
                showNotification(`–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —á–∞—Ç–µ: ${currentChat.name}`, 'info');
            }
        }

        function startNewChat() {
            showNotification('–ù–æ–≤—ã–π —á–∞—Ç', 'info');
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —á–∞—Ç–∞
        }

        function attachFile() {
            showNotification('–ü—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞', 'info');
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞
        }

        function showEmoji() {
            showNotification('–°–º–∞–π–ª–∏–∫–∏', 'info');
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –ø–∞–Ω–µ–ª—å —Å–º–∞–π–ª–∏–∫–æ–≤
        }

        function updateUnreadBadge() {
            const totalUnread = chats.reduce((sum, chat) => sum + chat.unread, 0);
            document.getElementById('unreadBadge').textContent = totalUnread;
        }

        // ==================== –ù–ê–°–¢–†–û–ô–ö–ò ====================
        function editProfile() {
            const newName = prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤–æ–µ –∏–º—è:', currentUser.name);
            if (newName && newName.trim()) {
                currentUser.name = newName.trim();
                currentUser.avatar = getInitials(currentUser.name);
                saveUserData();
                updateUserUI();
                showNotification('–ü—Ä–æ—Ñ–∏–ª—å –æ–±–Ω–æ–≤–ª–µ–Ω', 'success');
            }
        }

        function getInitials(name) {
            return name.split(' ')
                .map(word => word[0])
                .join('')
                .toUpperCase()
                .substring(0, 2);
        }

        function changePassword() {
            showNotification('–°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è', 'info');
        }

        function privacySettings() {
            showNotification('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏', 'info');
        }

        function blockedUsers() {
            showNotification('–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏', 'info');
        }

        function notificationSettings() {
            showNotification('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π', 'info');
        }

        function dataStorage() {
            showNotification('–•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö', 'info');
        }

        function aboutApp() {
            showNotification('Telegram Web v1.0\n–†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ WebRTC', 'info');
        }

        function logout() {
            if (confirm('–í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞?')) {
                localStorage.removeItem('telegram_user');
                location.reload();
            }
        }

        // ==================== –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø ====================
        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            const title = document.getElementById('notificationTitle');
            const body = document.getElementById('notificationBody');
            
            body.textContent = message;
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ü–≤–µ—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞
            if (type === 'error') {
                title.innerHTML = '‚ö†Ô∏è –û—à–∏–±–∫–∞';
            } else if (type === 'success') {
                title.innerHTML = '‚úÖ –£—Å–ø–µ—à–Ω–æ';
            } else {
                title.innerHTML = '‚ÑπÔ∏è Telegram';
            }
            
            notification.classList.add('active');
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∫—Ä—ã—Ç–∏–µ
            setTimeout(() => {
                notification.classList.remove('active');
            }, 3000);
        }

        function hideNotification() {
            document.getElementById('notification').classList.remove('active');
        }

        // ==================== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ====================
        function getCurrentTime() {
            const now = new Date();
            return `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
        }

        function getCurrentTimeShort() {
            const now = new Date();
            const hours = now.getHours();
            if (hours < 12) return '—É—Ç—Ä–æ';
            if (hours < 18) return '–¥–µ–Ω—å';
            return '–≤–µ—á–µ—Ä';
        }

        function adjustTextareaHeight(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = Math.min(textarea.scrollHeight, 120) + 'px';
        }

        // ==================== –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –°–û–ë–´–¢–ò–ô ====================
        function setupEventListeners() {
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –≤—ã—Å–æ—Ç—ã textarea
            const messageInput = document.getElementById('messageInput');
            messageInput.addEventListener('input', function() {
                adjustTextareaHeight(this);
            });

            // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ Enter (–±–µ–∑ Shift)
            messageInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });

            // –ó–∞–∫—Ä—ã—Ç–∏–µ –∑–≤–æ–Ω–∫–∞ –ø–æ Escape
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && isCallActive) {
                    endCall();
                }
            });

            // –ê–¥–∞–ø—Ç–∞—Ü–∏—è –∫ –º–æ–±–∏–ª—å–Ω—ã–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º
            window.addEventListener('resize', function() {
                if (window.innerWidth > 768) {
                    document.getElementById('sidebar').classList.remove('active');
                }
            });
        }
    </script>
</body>
</html>
