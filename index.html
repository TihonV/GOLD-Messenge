<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Web</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* –°–ë–†–û–° –ò –ë–ê–ó–û–í–´–ï –°–¢–ò–õ–ò */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: #0e1621;
            color: #fff;
            height: 100vh;
            overflow: hidden;
        }

        /* –≠–ö–†–ê–ù –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò */
        .auth-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            transition: opacity 0.3s;
        }

        .auth-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .auth-container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px;
            width: 90%;
            max-width: 400px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .auth-tabs {
            display: flex;
            margin-bottom: 30px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .auth-tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.7);
            transition: all 0.3s;
        }

        .auth-tab.active {
            color: #fff;
            border-bottom: 2px solid #fff;
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
        }

        .auth-title {
            text-align: center;
            font-size: 24px;
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            color: rgba(255, 255, 255, 0.9);
        }

        .form-input {
            width: 100%;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            color: #fff;
            font-size: 16px;
            transition: all 0.3s;
        }

        .form-input:focus {
            outline: none;
            border-color: #fff;
            background: rgba(255, 255, 255, 0.15);
        }

        .auth-btn {
            width: 100%;
            padding: 15px;
            background: #fff;
            color: #667eea;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
        }

        .auth-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .auth-error {
            color: #ff6b6b;
            font-size: 14px;
            margin-top: 10px;
            text-align: center;
            display: none;
        }

        .auth-error.active {
            display: block;
        }

        /* –ì–õ–ê–í–ù–´–ô –ö–û–ù–¢–ï–ô–ù–ï–† */
        .app-container {
            display: flex;
            height: 100vh;
            position: relative;
        }

        /* –õ–ï–í–´–ô –ë–û–ö–û–í–û–ô –ë–ê–† - –ú–ï–ù–Æ */
        .left-menu {
            width: 70px;
            background: #182533;
            border-right: 1px solid #2d3b4d;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px 0;
            gap: 25px;
            z-index: 10;
        }

        .menu-item {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #8a8a8a;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }

        .menu-item:hover {
            background: #2a3b52;
            color: #fff;
        }

        .menu-item.active {
            background: #2b5278;
            color: #fff;
        }

        .menu-item .badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #0088cc;
            color: white;
            font-size: 11px;
            padding: 2px 5px;
            border-radius: 10px;
            min-width: 18px;
            text-align: center;
        }

        /* –°–ê–ô–î–ë–ê–† –° –ß–ê–¢–ê–ú–ò */
        .sidebar {
            width: 350px;
            background: #182533;
            border-right: 1px solid #2d3b4d;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s;
        }

        /* –®–ê–ü–ö–ê –°–ê–ô–î–ë–ê–†–ê */
        .sidebar-header {
            padding: 15px 20px;
            border-bottom: 1px solid #2d3b4d;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 16px;
            position: relative;
            overflow: hidden;
        }

        .user-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .user-status {
            position: absolute;
            bottom: 0;
            right: 0;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #4CAF50;
            border: 2px solid #182533;
        }

        .user-info {
            flex: 1;
        }

        .user-name {
            font-weight: 600;
            font-size: 15px;
        }

        .user-online {
            font-size: 13px;
            color: #8a8a8a;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* –ü–û–ò–°–ö */
        .search-container {
            padding: 15px 20px;
            border-bottom: 1px solid #2d3b4d;
        }

        .search-box {
            background: #0e1621;
            border-radius: 8px;
            padding: 8px 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .search-input {
            background: none;
            border: none;
            color: #fff;
            flex: 1;
            font-size: 14px;
            outline: none;
        }

        /* –°–ü–ò–°–û–ö –ß–ê–¢–û–í */
        .chat-list {
            flex: 1;
            overflow-y: auto;
            padding-bottom: 20px;
        }

        .chat-item {
            padding: 12px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            border-bottom: 1px solid #2d3b4d;
            transition: background 0.2s;
            position: relative;
        }

        .chat-item:hover {
            background: #2a3b52;
        }

        .chat-item.active {
            background: #2b5278;
        }

        .chat-avatar {
            position: relative;
        }

        .chat-avatar-img {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: linear-gradient(135deg, #4CAF50, #8BC34A);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
            overflow: hidden;
        }

        .chat-avatar-img img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .chat-status {
            position: absolute;
            bottom: 0;
            right: 0;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: #4CAF50;
            border: 2px solid #182533;
        }

        .chat-info {
            flex: 1;
            min-width: 0;
        }

        .chat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 4px;
        }

        .chat-name {
            font-weight: 600;
            font-size: 15px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .chat-time {
            font-size: 12px;
            color: #8a8a8a;
        }

        .chat-preview {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 14px;
            color: #8a8a8a;
        }

        .chat-preview-text {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            flex: 1;
        }

        .chat-unread {
            background: #0088cc;
            color: white;
            font-size: 12px;
            padding: 2px 6px;
            border-radius: 10px;
            min-width: 20px;
            text-align: center;
        }

        /* –û–°–ù–û–í–ù–û–ô –ß–ê–¢ */
        .main-chat {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #0e1621;
        }

        /* –®–ê–ü–ö–ê –ß–ê–¢–ê */
        .chat-header-main {
            padding: 15px 20px;
            border-bottom: 1px solid #2d3b4d;
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: #182533;
        }

        .chat-contact {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .chat-contact-info {
            display: flex;
            flex-direction: column;
        }

        .chat-contact-name {
            font-weight: 600;
            font-size: 16px;
        }

        .chat-contact-status {
            font-size: 13px;
            color: #8a8a8a;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .online-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #4CAF50;
        }

        .chat-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .chat-action-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: #8a8a8a;
            font-size: 18px;
            transition: all 0.2s;
        }

        .chat-action-btn:hover {
            background: #2a3b52;
            color: #fff;
        }

        /* –°–û–û–ë–©–ï–ù–ò–Ø */
        .messages-container {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 10px;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" opacity="0.05"><path d="M0,0 L100,100" stroke="gray" stroke-width="1"/><path d="M100,0 L0,100" stroke="gray" stroke-width="1"/></svg>');
            background-size: 100px 100px;
        }

        .message-date {
            text-align: center;
            margin: 20px 0;
        }

        .date-label {
            background: #182533;
            padding: 5px 15px;
            border-radius: 12px;
            font-size: 13px;
            color: #8a8a8a;
            display: inline-block;
        }

        .message {
            max-width: 70%;
            margin-bottom: 10px;
            animation: messageAppear 0.2s ease-out;
        }

        @keyframes messageAppear {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.outgoing {
            align-self: flex-end;
        }

        .message.incoming {
            align-self: flex-start;
        }

        .message-bubble {
            padding: 10px 15px;
            border-radius: 12px;
            position: relative;
            word-wrap: break-word;
            line-height: 1.4;
        }

        .message.outgoing .message-bubble {
            background: #2b5278;
            border-bottom-right-radius: 5px;
        }

        .message.incoming .message-bubble {
            background: #182533;
            border-bottom-left-radius: 5px;
        }

        .message-time {
            font-size: 11px;
            color: #8a8a8a;
            margin-top: 5px;
            display: flex;
            justify-content: flex-end;
            align-items: center;
            gap: 5px;
        }

        /* –í–í–û–î –°–û–û–ë–©–ï–ù–ò–ô */
        .message-input-container {
            padding: 15px 20px;
            border-top: 1px solid #2d3b4d;
            display: flex;
            align-items: center;
            gap: 15px;
            background: #182533;
        }

        .input-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .input-action-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: #8a8a8a;
            font-size: 20px;
            transition: all 0.2s;
        }

        .input-action-btn:hover {
            background: #2a3b52;
            color: #fff;
        }

        .message-input-wrapper {
            flex: 1;
            background: #0e1621;
            border-radius: 25px;
            padding: 10px 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .message-input {
            flex: 1;
            background: none;
            border: none;
            color: #fff;
            font-size: 15px;
            resize: none;
            max-height: 120px;
            min-height: 20px;
            padding: 5px 0;
            outline: none;
            font-family: inherit;
        }

        .send-button {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #0088cc;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: none;
            font-size: 18px;
            transition: background 0.2s;
        }

        .send-button:hover {
            background: #0077b3;
        }

        /* –í–ò–î–ï–û–ó–í–û–ù–û–ö */
        .call-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #000;
            z-index: 1000;
            display: none;
            flex-direction: column;
        }

        .call-overlay.active {
            display: flex;
        }

        .call-container {
            flex: 1;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .remote-video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            background: #111;
        }

        .local-video {
            position: absolute;
            bottom: 20px;
            right: 20px;
            width: 200px;
            height: 150px;
            border-radius: 10px;
            border: 2px solid #fff;
            object-fit: cover;
            background: #333;
        }

        .call-info {
            position: absolute;
            top: 20px;
            left: 20px;
            color: white;
            z-index: 10;
        }

        .call-name {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .call-status {
            font-size: 14px;
            color: #ccc;
        }

        .call-controls {
            position: absolute;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 20px;
            z-index: 10;
        }

        .call-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            backdrop-filter: blur(10px);
        }

        .call-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }

        .call-btn.end-call {
            background: #ff3b30;
        }

        .call-btn.end-call:hover {
            background: #ff1f1f;
        }

        .call-btn.muted {
            background: #ff3b30;
        }

        /* –ú–û–î–ê–õ–¨–ù–´–ï –û–ö–ù–ê */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: #182533;
            border-radius: 20px;
            padding: 30px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
        }

        .modal-close {
            cursor: pointer;
            color: #8a8a8a;
            font-size: 24px;
        }

        .modal-close:hover {
            color: #fff;
        }

        .avatar-upload {
            text-align: center;
            margin-bottom: 20px;
        }

        .avatar-preview {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            font-weight: bold;
            overflow: hidden;
            position: relative;
        }

        .avatar-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .avatar-change {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.7);
            padding: 8px;
            cursor: pointer;
            font-size: 14px;
            display: none;
        }

        .avatar-preview:hover .avatar-change {
            display: block;
        }

        .modal-actions {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            margin-top: 30px;
        }

        .modal-btn {
            padding: 12px 24px;
            border-radius: 10px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            font-size: 16px;
            transition: all 0.2s;
        }

        .modal-btn-primary {
            background: #0088cc;
            color: white;
        }

        .modal-btn-primary:hover {
            background: #0077b3;
            transform: translateY(-2px);
        }

        .modal-btn-secondary {
            background: transparent;
            color: #8a8a8a;
            border: 1px solid #2d3b4d;
        }

        .modal-btn-secondary:hover {
            background: #2a3b52;
            color: #fff;
        }

        /* –ü–ê–ù–ï–õ–¨ –ù–ê–°–¢–†–û–ï–ö */
        .settings-panel {
            position: fixed;
            top: 0;
            right: -400px;
            width: 400px;
            height: 100%;
            background: #182533;
            border-left: 1px solid #2d3b4d;
            transition: right 0.3s;
            z-index: 100;
            overflow-y: auto;
        }

        .settings-panel.active {
            right: 0;
        }

        .settings-header {
            padding: 20px;
            border-bottom: 1px solid #2d3b4d;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .settings-title {
            font-size: 18px;
            font-weight: 600;
        }

        .settings-close {
            cursor: pointer;
            color: #8a8a8a;
            font-size: 24px;
        }

        .settings-content {
            padding: 20px;
        }

        .settings-section {
            margin-bottom: 30px;
        }

        .settings-section-title {
            font-size: 14px;
            color: #8a8a8a;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .setting-item {
            padding: 15px;
            background: #0e1621;
            border-radius: 10px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .setting-item:hover {
            background: #2a3b52;
        }

        .setting-label {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .setting-desc {
            font-size: 13px;
            color: #8a8a8a;
        }

        /* –ú–û–ë–ò–õ–¨–ù–ê–Ø –í–ï–†–°–ò–Ø */
        @media (max-width: 768px) {
            .left-menu {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                top: auto;
                width: 100%;
                height: 60px;
                flex-direction: row;
                justify-content: space-around;
                padding: 0;
                border-top: 1px solid #2d3b4d;
                z-index: 50;
            }

            .sidebar {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                z-index: 40;
                transform: translateX(-100%);
            }

            .sidebar.active {
                transform: translateX(0);
            }

            .main-chat {
                width: 100%;
            }

            .chat-action-btn {
                width: 44px;
                height: 44px;
                font-size: 20px;
            }

            .local-video {
                width: 120px;
                height: 90px;
                bottom: 100px;
                right: 10px;
            }

            .settings-panel {
                width: 100%;
                right: -100%;
            }

            .call-controls {
                bottom: 80px;
            }

            .mobile-menu-btn {
                display: flex;
            }

            .auth-container {
                padding: 30px 20px;
            }

            .modal {
                padding: 20px;
            }
        }

        /* –ö–ù–û–ü–ö–ê –ú–ï–ù–Æ –î–õ–Ø –ú–û–ë–ò–õ–¨–ù–û–ô –í–ï–†–°–ò–ò */
        .mobile-menu-btn {
            display: none;
            position: fixed;
            top: 15px;
            left: 15px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #2b5278;
            color: white;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            cursor: pointer;
            z-index: 60;
        }

        @media (max-width: 768px) {
            .mobile-menu-btn {
                display: flex;
            }
        }

        /* –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #182533;
            border: 1px solid #2d3b4d;
            border-radius: 10px;
            padding: 15px;
            max-width: 300px;
            z-index: 1000;
            animation: slideIn 0.3s ease-out;
            display: none;
        }

        .notification.active {
            display: block;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .notification-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .notification-title {
            font-weight: 600;
        }

        .notification-body {
            font-size: 14px;
            color: #8a8a8a;
        }

        .notification-close {
            cursor: pointer;
            color: #8a8a8a;
        }

        /* –ö–ê–ù–ê–õ–´ */
        .channel-item {
            padding: 12px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            border-bottom: 1px solid #2d3b4d;
        }

        .channel-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: linear-gradient(135deg, #FF5722, #FF9800);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
        }

        /* –°–ö–†–´–¢–´–ï –≠–õ–ï–ú–ï–ù–¢–´ */
        .hidden {
            display: none !important;
        }

        /* –ó–ê–ì–†–£–ó–ö–ê */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background: #0e1621;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 2000;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid #2b5278;
            border-top: 3px solid #0088cc;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- –≠–ö–†–ê–ù –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò -->
    <div class="auth-screen" id="authScreen">
        <div class="auth-container">
            <div class="auth-tabs">
                <div class="auth-tab active" onclick="showLoginForm()">–í—Ö–æ–¥</div>
                <div class="auth-tab" onclick="showRegisterForm()">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</div>
            </div>
            
            <form class="auth-form active" id="loginForm" onsubmit="return login(event)">
                <div class="auth-title">–í—Ö–æ–¥ –≤ Telegram</div>
                
                <div class="form-group">
                    <label class="form-label">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                    <input type="text" class="form-input" id="loginUsername" placeholder="tihon" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">–ü–∞—Ä–æ–ª—å</label>
                    <input type="password" class="form-input" id="loginPassword" placeholder="‚óè‚óè‚óè‚óè‚óè‚óè" required>
                </div>
                
                <div class="auth-error" id="loginError">–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å</div>
                
                <button type="submit" class="auth-btn">–í–æ–π—Ç–∏</button>
                
                <div style="text-align: center; margin-top: 20px; color: rgba(255, 255, 255, 0.7); font-size: 14px;">
                    –¢–µ—Å—Ç–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏:<br>
                    tihon / 2011<br>
                    olga / 123456<br>
                    pavel / qwerty
                </div>
            </form>
            
            <form class="auth-form" id="registerForm" onsubmit="return register(event)">
                <div class="auth-title">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</div>
                
                <div class="form-group">
                    <label class="form-label">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                    <input type="text" class="form-input" id="registerUsername" placeholder="tihon" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">–ò–º—è</label>
                    <input type="text" class="form-input" id="registerName" placeholder="–¢–∏—Ö–æ–Ω –ú–µ—Ç–µ–ª–∫–∏–Ω" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">–ü–∞—Ä–æ–ª—å</label>
                    <input type="password" class="form-input" id="registerPassword" placeholder="‚óè‚óè‚óè‚óè‚óè‚óè" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å</label>
                    <input type="password" class="form-input" id="registerPasswordConfirm" placeholder="‚óè‚óè‚óè‚óè‚óè‚óè" required>
                </div>
                
                <div class="auth-error" id="registerError"></div>
                
                <button type="submit" class="auth-btn">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
            </form>
        </div>
    </div>

    <!-- –ó–ê–ì–†–£–ó–ö–ê -->
    <div class="loading hidden" id="loading">
        <div class="spinner"></div>
    </div>

    <!-- –ì–õ–ê–í–ù–´–ô –ö–û–ù–¢–ï–ô–ù–ï–† -->
    <div class="app-container hidden" id="appContainer">
        <!-- –õ–ï–í–û–ï –ú–ï–ù–Æ -->
        <div class="left-menu">
            <div class="menu-item active" title="–ß–∞—Ç—ã" onclick="showChats()">
                <i class="fas fa-comment-alt"></i>
                <span class="badge" id="unreadBadge">0</span>
            </div>
            <div class="menu-item" title="–ö–∞–Ω–∞–ª—ã" onclick="showChannels()">
                <i class="fas fa-broadcast-tower"></i>
                <span class="badge" id="channelBadge">42</span>
            </div>
            <div class="menu-item" title="–ù–∞—Å—Ç—Ä–æ–π–∫–∏" onclick="showSettings()">
                <i class="fas fa-cog"></i>
            </div>
        </div>

        <!-- –ö–ù–û–ü–ö–ê –ú–ï–ù–Æ –î–õ–Ø –ú–û–ë–ò–õ–¨–ù–û–ö -->
        <div class="mobile-menu-btn" onclick="toggleSidebar()">
            <i class="fas fa-bars"></i>
        </div>

        <!-- –°–ê–ô–î–ë–ê–† –° –ß–ê–¢–ê–ú–ò -->
        <div class="sidebar" id="sidebar">
            <!-- –®–ê–ü–ö–ê –°–ê–ô–î–ë–ê–†–ê -->
            <div class="sidebar-header">
                <div class="user-profile" onclick="showProfileModal()">
                    <div class="user-avatar" id="userAvatar">
                        <!-- –ê–≤–∞—Ç–∞—Ä –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
                    </div>
                    <div class="user-info">
                        <div class="user-name" id="userName">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                        <div class="user-online">
                            <i class="fas fa-circle" style="color: #4CAF50; font-size: 8px;"></i>
                            <span id="userStatus">–æ–Ω–ª–∞–π–Ω</span>
                        </div>
                    </div>
                </div>
                <div class="chat-action-btn" title="–ù–æ–≤—ã–π —á–∞—Ç" onclick="startNewChat()">
                    <i class="fas fa-edit"></i>
                </div>
            </div>

            <!-- –ü–û–ò–°–ö -->
            <div class="search-container">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" class="search-input" placeholder="–ü–æ–∏—Å–∫" id="searchInput" oninput="searchChats()">
                </div>
            </div>

            <!-- –°–ü–ò–°–û–ö –ß–ê–¢–û–í -->
            <div class="chat-list" id="chatList">
                <!-- –ß–ê–¢–´ –ë–£–î–£–¢ –î–û–ë–ê–í–õ–Ø–¢–¨–°–Ø –ó–î–ï–°–¨ -->
            </div>

            <!-- –ö–ê–ù–ê–õ–´ (—Å–∫—Ä—ã—Ç–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) -->
            <div class="chat-list hidden" id="channelList">
                <!-- –ö–ê–ù–ê–õ–´ –ë–£–î–£–¢ –î–û–ë–ê–í–õ–Ø–¢–¨–°–Ø –ó–î–ï–°–¨ -->
            </div>
        </div>

        <!-- –û–°–ù–û–í–ù–û–ô –ß–ê–¢ -->
        <div class="main-chat">
            <!-- –®–ê–ü–ö–ê –ß–ê–¢–ê -->
            <div class="chat-header-main">
                <div class="chat-contact">
                    <div class="user-avatar" id="currentChatAvatar">
                        <!-- –ê–≤–∞—Ç–∞—Ä —á–∞—Ç–∞ –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
                    </div>
                    <div class="chat-contact-info">
                        <div class="chat-contact-name" id="currentChatName">–í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Ç</div>
                        <div class="chat-contact-status" id="currentChatStatus">
                            <!-- –°—Ç–∞—Ç—É—Å –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
                        </div>
                    </div>
                </div>
                <div class="chat-actions">
                    <div class="chat-action-btn" title="–í–∏–¥–µ–æ–∑–≤–æ–Ω–æ–∫" onclick="startVideoCall()" id="videoCallBtn" style="display: none;">
                        <i class="fas fa-video"></i>
                    </div>
                </div>
            </div>

            <!-- –°–û–û–ë–©–ï–ù–ò–Ø -->
            <div class="messages-container" id="messagesContainer">
                <div class="message-date">
                    <span class="date-label">–í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Ç –¥–ª—è –Ω–∞—á–∞–ª–∞ –æ–±—â–µ–Ω–∏—è</span>
                </div>
            </div>

            <!-- –í–í–û–î –°–û–û–ë–©–ï–ù–ò–ô -->
            <div class="message-input-container" id="messageInputContainer" style="display: none;">
                <div class="input-actions">
                    <div class="input-action-btn" title="–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å —Ñ–∞–π–ª" onclick="attachFile()">
                        <i class="fas fa-paperclip"></i>
                    </div>
                </div>
                <div class="message-input-wrapper">
                    <textarea class="message-input" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ" rows="1" id="messageInput"></textarea>
                </div>
                <button class="send-button" title="–û—Ç–ø—Ä–∞–≤–∏—Ç—å" onclick="sendMessage()">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- –í–ò–î–ï–û–ó–í–û–ù–û–ö -->
    <div class="call-overlay" id="callOverlay">
        <div class="call-container">
            <div class="call-info">
                <div class="call-name" id="callContactName">–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ...</div>
                <div class="call-status" id="callStatus">–£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è...</div>
            </div>
            <video class="remote-video" id="remoteVideo" autoplay playsinline></video>
            <video class="local-video" id="localVideo" autoplay playsinline muted></video>
            <div class="call-controls">
                <button class="call-btn" id="toggleAudioBtn" onclick="toggleAudio()">
                    <i class="fas fa-microphone"></i>
                </button>
                <button class="call-btn" id="toggleVideoBtn" onclick="toggleVideo()">
                    <i class="fas fa-video"></i>
                </button>
                <button class="call-btn end-call" onclick="endCall()">
                    <i class="fas fa-phone-slash"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –ü–†–û–§–ò–õ–Ø -->
    <div class="modal-overlay" id="profileModal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</div>
                <div class="modal-close" onclick="hideProfileModal()">√ó</div>
            </div>
            
            <div class="avatar-upload">
                <div class="avatar-preview" id="avatarPreview" onclick="triggerAvatarUpload()">
                    <!-- –ê–≤–∞—Ç–∞—Ä –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω —á–µ—Ä–µ–∑ JS -->
                    <div class="avatar-change">–ò–∑–º–µ–Ω–∏—Ç—å</div>
                </div>
                <input type="file" id="avatarInput" accept="image/*" style="display: none;" onchange="handleAvatarUpload(event)">
            </div>
            
            <div class="form-group">
                <label class="form-label">–ò–º—è</label>
                <input type="text" class="form-input" id="profileName" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è">
            </div>
            
            <div class="form-group">
                <label class="form-label">–°—Ç–∞—Ç—É—Å</label>
                <input type="text" class="form-input" id="profileStatus" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à —Å—Ç–∞—Ç—É—Å">
            </div>
            
            <div class="modal-actions">
                <button class="modal-btn modal-btn-secondary" onclick="hideProfileModal()">
                    –û—Ç–º–µ–Ω–∞
                </button>
                <button class="modal-btn modal-btn-primary" onclick="saveProfile()">
                    –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                </button>
            </div>
        </div>
    </div>

    <!-- –ü–ê–ù–ï–õ–¨ –ù–ê–°–¢–†–û–ï–ö -->
    <div class="settings-panel" id="settingsPanel">
        <div class="settings-header">
            <div class="settings-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>
            <div class="settings-close" onclick="hideSettings()">√ó</div>
        </div>
        <div class="settings-content">
            <div class="settings-section">
                <div class="settings-section-title">–ê–∫–∫–∞—É–Ω—Ç</div>
                <div class="setting-item" onclick="showProfileModal()">
                    <div class="setting-label">–ò–∑–º–µ–Ω–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</div>
                    <div class="setting-desc">–ò–º—è, —Ñ–æ—Ç–æ, —Å—Ç–∞—Ç—É—Å</div>
                </div>
                <div class="setting-item" onclick="changePassword()">
                    <div class="setting-label">–ò–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å</div>
                    <div class="setting-desc">–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç–∞</div>
                </div>
            </div>
            
            <div class="settings-section">
                <div class="setting-item" onclick="logout()" style="background: #ff3b30; color: white;">
                    <div class="setting-label">–í—ã–π—Ç–∏</div>
                    <div class="setting-desc">–ó–∞–≤–µ—Ä—à–∏—Ç—å —Å–µ–∞–Ω—Å</div>
                </div>
            </div>
        </div>
    </div>

    <!-- –£–í–ï–î–û–ú–õ–ï–ù–ò–ï -->
    <div class="notification" id="notification">
        <div class="notification-header">
            <div class="notification-title" id="notificationTitle">Telegram</div>
            <div class="notification-close" onclick="hideNotification()">√ó</div>
        </div>
        <div class="notification-body" id="notificationBody">–°–æ–æ–±—â–µ–Ω–∏–µ</div>
    </div>

    <!-- –°–ö–†–ò–ü–¢–´ -->
    <script>
        // ==================== –ë–ê–ó–ê –î–ê–ù–ù–´–• –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ô ====================
        class UserDatabase {
            constructor() {
                this.users = JSON.parse(localStorage.getItem('telegram_users')) || this.createDefaultUsers();
                this.save();
            }

            createDefaultUsers() {
                return [
                    {
                        id: '1',
                        username: 'tihon',
                        password: '2011',
                        name: '–¢–∏—Ö–æ–Ω –ú–µ—Ç–µ–ª–∫–∏–Ω',
                        avatar: 'TM',
                        status: 'üéß –æ–Ω–ª–∞–π–Ω',
                        isOnline: true,
                        chats: []
                    },
                    {
                        id: '2',
                        username: 'olga',
                        password: '123456',
                        name: '–û–ª—å–≥–∞ –ú–µ—Ç–µ–ª–∫–∏–Ω–∞',
                        avatar: '–û–ú',
                        status: 'üíº –Ω–∞ —Ä–∞–±–æ—Ç–µ',
                        isOnline: true,
                        chats: []
                    },
                    {
                        id: '3',
                        username: 'pavel',
                        password: 'qwerty',
                        name: '–ü–∞–≤–µ–ª –í–∏–ª–∫–æ–≤',
                        avatar: '–ü–í',
                        status: 'üè† –¥–æ–º–∞',
                        isOnline: false,
                        chats: []
                    }
                ];
            }

            findUser(username, password) {
                return this.users.find(user => 
                    user.username === username && user.password === password
                );
            }

            findUserById(id) {
                return this.users.find(user => user.id === id);
            }

            findUserByUsername(username) {
                return this.users.find(user => user.username === username);
            }

            createUser(username, password, name) {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
                if (this.findUserByUsername(username)) {
                    return { success: false, error: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç' };
                }

                const newUser = {
                    id: Date.now().toString(),
                    username,
                    password,
                    name,
                    avatar: this.getInitials(name),
                    status: '–æ–Ω–ª–∞–π–Ω',
                    isOnline: true,
                    chats: []
                };

                this.users.push(newUser);
                this.save();
                return { success: true, user: newUser };
            }

            updateUser(userId, updates) {
                const userIndex = this.users.findIndex(u => u.id === userId);
                if (userIndex === -1) return false;

                this.users[userIndex] = { ...this.users[userIndex], ...updates };
                this.save();
                return true;
            }

            getInitials(name) {
                return name.split(' ')
                    .map(word => word[0])
                    .join('')
                    .toUpperCase()
                    .substring(0, 2);
            }

            save() {
                localStorage.setItem('telegram_users', JSON.stringify(this.users));
            }

            getAllUsersExcept(userId) {
                return this.users.filter(user => user.id !== userId);
            }
        }

        // ==================== –°–ò–°–¢–ï–ú–ê –ß–ê–¢–û–í ====================
        class ChatSystem {
            constructor() {
                this.chats = JSON.parse(localStorage.getItem('telegram_chats')) || this.createDefaultChats();
                this.save();
            }

            createDefaultChats() {
                return [
                    {
                        id: 'admin_chat',
                        type: 'group',
                        name: '–ü–æ–¥–¥–µ—Ä–∂–∫–∞',
                        avatar: 'üÜò',
                        participants: ['1', '2', '3'],
                        messages: [
                            { id: '1', userId: '1', text: '–ü—Ä–∏–≤–µ—Ç –≤—Å–µ–º!', time: '10:00', read: true },
                            { id: '2', userId: '2', text: '–ü—Ä–∏–≤–µ—Ç! –ö–∞–∫ –¥–µ–ª–∞?', time: '10:05', read: true },
                            { id: '3', userId: '3', text: '–í—Å–µ–º –ø—Ä–∏–≤–µ—Ç!', time: '10:10', read: true }
                        ],
                        lastActivity: Date.now()
                    },
                    {
                        id: 'tihon_olga',
                        type: 'private',
                        participants: ['1', '2'],
                        messages: [
                            { id: '1', userId: '2', text: '–ü—Ä–∏–≤–µ—Ç! –ö–∞–∫ —Ç–≤–æ–π –ø—Ä–æ–µ–∫—Ç?', time: '15:30', read: true },
                            { id: '2', userId: '1', text: '–ü—Ä–∏–≤–µ—Ç! –í—Å—ë –æ—Ç–ª–∏—á–Ω–æ, –ø–æ—á—Ç–∏ –∑–∞–∫–æ–Ω—á–∏–ª!', time: '15:32', read: true },
                            { id: '3', userId: '2', text: '–°—É–ø–µ—Ä! –ü–æ–∫–∞–∂–µ—à—å –∫–æ–≥–¥–∞ –∑–∞–∫–æ–Ω—á–∏—à—å?', time: '15:35', read: true }
                        ],
                        lastActivity: Date.now()
                    },
                    {
                        id: 'tihon_pavel',
                        type: 'private',
                        participants: ['1', '3'],
                        messages: [
                            { id: '1', userId: '3', text: '–ü—Ä–∏–≤–µ—Ç! –í—Å—Ç—Ä–µ—á–∞–µ–º—Å—è –≤ 18:00?', time: '–í—á–µ—Ä–∞ 17:45', read: false },
                            { id: '2', userId: '1', text: '–î–∞, —Ç–æ—á–Ω–æ!', time: '–í—á–µ—Ä–∞ 17:46', read: true }
                        ],
                        lastActivity: Date.now() - 86400000 // –≤—á–µ—Ä–∞
                    }
                ];
            }

            getChatsForUser(userId) {
                return this.chats.filter(chat => 
                    chat.participants.includes(userId)
                );
            }

            getChatBetweenUsers(userId1, userId2) {
                return this.chats.find(chat => 
                    chat.type === 'private' && 
                    chat.participants.includes(userId1) && 
                    chat.participants.includes(userId2)
                );
            }

            createPrivateChat(userId1, userId2) {
                const chatId = `chat_${Date.now()}`;
                const newChat = {
                    id: chatId,
                    type: 'private',
                    participants: [userId1, userId2],
                    messages: [],
                    lastActivity: Date.now()
                };

                this.chats.push(newChat);
                this.save();
                return newChat;
            }

            addMessage(chatId, userId, text) {
                const chat = this.chats.find(c => c.id === chatId);
                if (!chat) return null;

                const message = {
                    id: `msg_${Date.now()}`,
                    userId,
                    text,
                    time: this.getCurrentTime(),
                    read: false
                };

                chat.messages.push(message);
                chat.lastActivity = Date.now();
                this.save();

                return message;
            }

            markMessagesAsRead(chatId, userId) {
                const chat = this.chats.find(c => c.id === chatId);
                if (!chat) return;

                chat.messages.forEach(msg => {
                    if (msg.userId !== userId) {
                        msg.read = true;
                    }
                });

                this.save();
            }

            getUnreadCount(chatId, userId) {
                const chat = this.chats.find(c => c.id === chatId);
                if (!chat) return 0;

                return chat.messages.filter(msg => 
                    msg.userId !== userId && !msg.read
                ).length;
            }

            getCurrentTime() {
                const now = new Date();
                return `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
            }

            save() {
                localStorage.setItem('telegram_chats', JSON.stringify(this.chats));
            }
        }

        // ==================== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï ====================
        let currentUser = null;
        let currentChat = null;
        let userDB = null;
        let chatSystem = null;
        let socket = null;
        let localStream = null;
        let isCallActive = false;
        let isAudioMuted = false;
        let isVideoOff = false;

        // ==================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ====================
        document.addEventListener('DOMContentLoaded', function() {
            userDB = new UserDatabase();
            chatSystem = new ChatSystem();
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –∞–∫—Ç–∏–≤–Ω–∞—è —Å–µ—Å—Å–∏—è
            const session = JSON.parse(localStorage.getItem('telegram_session'));
            if (session && session.userId && session.expires > Date.now()) {
                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—Ö–æ–¥
                const user = userDB.findUserById(session.userId);
                if (user) {
                    showLoading();
                    setTimeout(() => {
                        completeLogin(user);
                    }, 1000);
                } else {
                    showAuthScreen();
                }
            } else {
                showAuthScreen();
            }
        });

        function showAuthScreen() {
            document.getElementById('authScreen').classList.remove('hidden');
            document.getElementById('loading').classList.add('hidden');
        }

        function showLoading() {
            document.getElementById('loading').classList.remove('hidden');
        }

        function hideLoading() {
            document.getElementById('loading').classList.add('hidden');
        }

        // ==================== –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø ====================
        function showLoginForm() {
            document.getElementById('loginForm').classList.add('active');
            document.getElementById('registerForm').classList.remove('active');
            document.querySelectorAll('.auth-tab').forEach((tab, index) => {
                tab.classList.toggle('active', index === 0);
            });
            clearErrors();
        }

        function showRegisterForm() {
            document.getElementById('loginForm').classList.remove('active');
            document.getElementById('registerForm').classList.add('active');
            document.querySelectorAll('.auth-tab').forEach((tab, index) => {
                tab.classList.toggle('active', index === 1);
            });
            clearErrors();
        }

        function clearErrors() {
            document.getElementById('loginError').classList.remove('active');
            document.getElementById('registerError').classList.remove('active');
        }

        function login(event) {
            event.preventDefault();
            
            const username = document.getElementById('loginUsername').value.trim();
            const password = document.getElementById('loginPassword').value;
            
            if (!username || !password) {
                showError('loginError', '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
                return false;
            }

            showLoading();
            
            // –ò–º–∏—Ç–∞—Ü–∏—è –∑–∞–¥–µ—Ä–∂–∫–∏ —Å–µ—Ç–∏
            setTimeout(() => {
                const user = userDB.findUser(username, password);
                
                if (user) {
                    completeLogin(user);
                } else {
                    hideLoading();
                    showError('loginError', '–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å');
                }
            }, 1000);
            
            return false;
        }

        function register(event) {
            event.preventDefault();
            
            const username = document.getElementById('registerUsername').value.trim();
            const name = document.getElementById('registerName').value.trim();
            const password = document.getElementById('registerPassword').value;
            const passwordConfirm = document.getElementById('registerPasswordConfirm').value;
            
            // –í–∞–ª–∏–¥–∞—Ü–∏—è
            if (!username || !name || !password) {
                showError('registerError', '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
                return false;
            }
            
            if (password.length < 4) {
                showError('registerError', '–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 4 —Å–∏–º–≤–æ–ª–æ–≤');
                return false;
            }
            
            if (password !== passwordConfirm) {
                showError('registerError', '–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç');
                return false;
            }
            
            if (username.length < 3) {
                showError('registerError', '–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 3 —Å–∏–º–≤–æ–ª–æ–≤');
                return false;
            }

            showLoading();
            
            // –ò–º–∏—Ç–∞—Ü–∏—è –∑–∞–¥–µ—Ä–∂–∫–∏ —Å–µ—Ç–∏
            setTimeout(() => {
                const result = userDB.createUser(username, password, name);
                
                if (result.success) {
                    completeLogin(result.user);
                } else {
                    hideLoading();
                    showError('registerError', result.error);
                }
            }, 1000);
            
            return false;
        }

        function completeLogin(user) {
            currentUser = user;
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–µ—Å—Å–∏—é
            localStorage.setItem('telegram_session', JSON.stringify({
                userId: user.id,
                expires: Date.now() + 7 * 24 * 60 * 60 * 1000 // 7 –¥–Ω–µ–π
            }));
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            userDB.updateUser(user.id, { isOnline: true });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω
            document.getElementById('authScreen').classList.add('hidden');
            document.getElementById('appContainer').classList.remove('hidden');
            hideLoading();
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            updateUserProfile();
            loadUserChats();
            showNotification(`–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${user.name}!`, 'success');
            
            // –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ "—Å–µ—Ä–≤–µ—Ä—É"
            connectToServer();
        }

        function showError(elementId, message) {
            const errorElement = document.getElementById(elementId);
            errorElement.textContent = message;
            errorElement.classList.add('active');
        }

        // ==================== –û–°–ù–û–í–ù–û–ô –ò–ù–¢–ï–†–§–ï–ô–° ====================
        function updateUserProfile() {
            if (!currentUser) return;
            
            document.getElementById('userName').textContent = currentUser.name;
            document.getElementById('userStatus').textContent = currentUser.status;
            
            const avatarElement = document.getElementById('userAvatar');
            avatarElement.innerHTML = currentUser.avatar;
            avatarElement.style.background = getAvatarColor(currentUser.id);
            
            // –î–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–æ—Ñ–∏–ª—è
            document.getElementById('profileName').value = currentUser.name;
            document.getElementById('profileStatus').value = currentUser.status;
            
            const avatarPreview = document.getElementById('avatarPreview');
            avatarPreview.innerHTML = currentUser.avatar;
            avatarPreview.style.background = getAvatarColor(currentUser.id);
        }

        function getAvatarColor(userId) {
            const colors = [
                'linear-gradient(135deg, #667eea, #764ba2)',
                'linear-gradient(135deg, #4CAF50, #8BC34A)',
                'linear-gradient(135deg, #FF5722, #FF9800)',
                'linear-gradient(135deg, #2196F3, #03A9F4)',
                'linear-gradient(135deg, #E91E63, #9C27B0)'
            ];
            
            const index = parseInt(userId) % colors.length;
            return colors[index];
        }

        function loadUserChats() {
            if (!currentUser) return;
            
            const userChats = chatSystem.getChatsForUser(currentUser.id);
            const chatList = document.getElementById('chatList');
            chatList.innerHTML = '';
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º —á–∞—Ç—ã –ø–æ –ø–æ—Å–ª–µ–¥–Ω–µ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
            userChats.sort((a, b) => b.lastActivity - a.lastActivity);
            
            userChats.forEach(chat => {
                const chatItem = createChatItem(chat);
                chatList.appendChild(chatItem);
            });
            
            updateUnreadBadge();
        }

        function createChatItem(chat) {
            const chatItem = document.createElement('div');
            chatItem.className = 'chat-item';
            if (currentChat && chat.id === currentChat.id) {
                chatItem.classList.add('active');
            }
            
            // –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —á–∞—Ç–µ
            const chatInfo = getChatInfo(chat);
            const unreadCount = chatSystem.getUnreadCount(chat.id, currentUser.id);
            
            chatItem.innerHTML = `
                <div class="chat-avatar">
                    <div class="chat-avatar-img" style="background: ${getAvatarColor(chatInfo.id)}">
                        ${chatInfo.avatar}
                    </div>
                    ${chatInfo.isOnline ? '<div class="chat-status"></div>' : ''}
                </div>
                <div class="chat-info">
                    <div class="chat-header">
                        <div class="chat-name">${chatInfo.name}</div>
                        <div class="chat-time">${formatTime(chat.lastActivity)}</div>
                    </div>
                    <div class="chat-preview">
                        <div class="chat-preview-text">${getLastMessagePreview(chat)}</div>
                        ${unreadCount > 0 ? `<div class="chat-unread">${unreadCount}</div>` : ''}
                    </div>
                </div>
            `;
            
            chatItem.onclick = () => selectChat(chat);
            return chatItem;
        }

        function getChatInfo(chat) {
            if (chat.type === 'group') {
                return {
                    id: chat.id,
                    name: chat.name,
                    avatar: chat.avatar,
                    isOnline: true
                };
            } else {
                // –î–ª—è –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ —á–∞—Ç–∞ –Ω–∞—Ö–æ–¥–∏–º —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞
                const otherUserId = chat.participants.find(id => id !== currentUser.id);
                const otherUser = userDB.findUserById(otherUserId);
                
                if (otherUser) {
                    return {
                        id: otherUser.id,
                        name: otherUser.name,
                        avatar: otherUser.avatar,
                        isOnline: otherUser.isOnline
                    };
                }
            }
            
            return {
                id: 'unknown',
                name: '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π',
                avatar: '?',
                isOnline: false
            };
        }

        function getLastMessagePreview(chat) {
            if (!chat.messages || chat.messages.length === 0) {
                return '–ù–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π';
            }
            
            const lastMessage = chat.messages[chat.messages.length - 1];
            const isFromCurrentUser = lastMessage.userId === currentUser.id;
            const prefix = isFromCurrentUser ? '–í—ã: ' : '';
            
            return prefix + (lastMessage.text.length > 30 
                ? lastMessage.text.substring(0, 30) + '...' 
                : lastMessage.text);
        }

        function formatTime(timestamp) {
            const date = new Date(timestamp);
            const now = new Date();
            const diff = now - date;
            
            if (diff < 24 * 60 * 60 * 1000) {
                // –°–µ–≥–æ–¥–Ω—è
                return date.toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' });
            } else if (diff < 7 * 24 * 60 * 60 * 1000) {
                // –ù–∞ —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ
                const days = ['–í—Å', '–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±'];
                return days[date.getDay()];
            } else {
                // –†–∞–Ω–µ–µ
                return date.toLocaleDateString('ru-RU', { day: 'numeric', month: 'short' });
            }
        }

        function selectChat(chat) {
            currentChat = chat;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º UI
            updateChatUI();
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è
            loadMessages();
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞
            document.getElementById('messageInputContainer').style.display = 'flex';
            document.getElementById('videoCallBtn').style.display = 'flex';
            
            // –û—Ç–º–µ—á–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ
            chatSystem.markMessagesAsRead(chat.id, currentUser.id);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤
            loadUserChats();
            
            // –ù–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö —Å–∫—Ä—ã–≤–∞–µ–º —Å–∞–π–¥–±–∞—Ä
            if (window.innerWidth <= 768) {
                document.getElementById('sidebar').classList.remove('active');
            }
        }

        function updateChatUI() {
            if (!currentChat) return;
            
            const chatInfo = getChatInfo(currentChat);
            
            document.getElementById('currentChatName').textContent = chatInfo.name;
            document.getElementById('currentChatAvatar').innerHTML = `
                <div class="chat-avatar-img" style="background: ${getAvatarColor(chatInfo.id)}">
                    ${chatInfo.avatar}
                </div>
            `;
            
            const statusText = chatInfo.isOnline ? '–≤ —Å–µ—Ç–∏' : '–±—ã–ª(–∞) –Ω–µ–¥–∞–≤–Ω–æ';
            const statusHtml = chatInfo.isOnline 
                ? '<span class="online-indicator"></span> –≤ —Å–µ—Ç–∏'
                : `<span style="color: #8a8a8a;">${statusText}</span>`;
            
            document.getElementById('currentChatStatus').innerHTML = statusHtml;
            document.getElementById('callContactName').textContent = chatInfo.name;
        }

        function loadMessages() {
            if (!currentChat) return;
            
            const container = document.getElementById('messagesContainer');
            container.innerHTML = `
                <div class="message-date">
                    <span class="date-label">–°–µ–≥–æ–¥–Ω—è</span>
                </div>
            `;
            
            currentChat.messages.forEach(msg => {
                addMessageToUI(msg, false);
            });
            
            // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –≤–Ω–∏–∑
            container.scrollTop = container.scrollHeight;
        }

        function addMessageToUI(message, scroll = true) {
            if (!currentChat) return;
            
            const container = document.getElementById('messagesContainer');
            const isOutgoing = message.userId === currentUser.id;
            
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isOutgoing ? 'outgoing' : 'incoming'}`;
            
            const sender = isOutgoing ? currentUser : userDB.findUserById(message.userId);
            const senderName = sender ? sender.name : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π';
            
            let messageHtml = `
                <div class="message-bubble">${message.text}</div>
                <div class="message-time">${message.time}`;
            
            if (isOutgoing) {
                messageHtml += ` <i class="fas fa-check${message.read ? '-double' : ''}" style="color: ${message.read ? '#4CAF50' : '#8a8a8a'};"></i>`;
            }
            
            messageHtml += `</div>`;
            messageDiv.innerHTML = messageHtml;
            
            container.appendChild(messageDiv);
            
            if (scroll) {
                container.scrollTop = container.scrollHeight;
            }
        }

        // ==================== –°–û–û–ë–©–ï–ù–ò–Ø ====================
        function sendMessage() {
            if (!currentChat || !currentUser) return;
            
            const input = document.getElementById('messageInput');
            const text = input.value.trim();
            
            if (!text) return;
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç
            const message = chatSystem.addMessage(currentChat.id, currentUser.id, text);
            if (!message) return;
            
            // –î–æ–±–∞–≤–ª—è–µ–º –≤ UI
            addMessageToUI(message);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤
            loadUserChats();
            
            // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞
            input.value = '';
            adjustTextareaHeight(input);
            
            // –°–∏–º—É–ª—è—Ü–∏—è –æ—Ç–≤–µ—Ç–∞ –¥–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —á–∞—Ç–æ–≤
            simulateResponse();
        }

        function simulateResponse() {
            if (!currentChat || currentChat.type === 'group') return;
            
            // –ù–∞—Ö–æ–¥–∏–º —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞
            const otherUserId = currentChat.participants.find(id => id !== currentUser.id);
            const otherUser = userDB.findUserById(otherUserId);
            
            if (!otherUser || !otherUser.isOnline) return;
            
            // –°–ª—É—á–∞–π–Ω—ã–π –æ—Ç–≤–µ—Ç —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π
            if (Math.random() > 0.5) {
                setTimeout(() => {
                    const responses = [
                        '–ü—Ä–∏–≤–µ—Ç! –ö–∞–∫ –¥–µ–ª–∞?',
                        '–ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ!',
                        '–°–æ–≥–ª–∞—Å–µ–Ω!',
                        '–î–∞–≤–∞–π –æ–±—Å—É–¥–∏–º —ç—Ç–æ –ø–æ–¥—Ä–æ–±–Ω–µ–µ',
                        '–û—Ç–ª–∏—á–Ω–∞—è –∏–¥–µ—è!'
                    ];
                    
                    const response = responses[Math.floor(Math.random() * responses.length)];
                    const replyMessage = chatSystem.addMessage(currentChat.id, otherUserId, response);
                    
                    if (replyMessage && currentChat.id === currentChat.id) {
                        addMessageToUI(replyMessage);
                        loadUserChats();
                        showNotification(`–ù–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç ${otherUser.name}`, 'info');
                    }
                }, 1000 + Math.random() * 2000);
            }
        }

        // ==================== –í–ò–î–ï–û–ó–í–û–ù–ö–ò ====================
        async function startVideoCall() {
            if (!currentChat || !currentUser) {
                showNotification('–í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Ç –¥–ª—è –∑–≤–æ–Ω–∫–∞', 'error');
                return;
            }

            try {
                showNotification('–ó–∞–ø—É—Å–∫ –≤–∏–¥–µ–æ–∑–≤–æ–Ω–∫–∞...', 'info');
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –∑–≤–æ–Ω–∫–∞
                document.getElementById('callOverlay').classList.add('active');
                document.getElementById('callStatus').textContent = '–ó–∞–ø—Ä–æ—Å –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–º–µ—Ä–µ...';

                // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –¥–æ—Å—Ç—É–ø –∫ –º–µ–¥–∏–∞—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º
                localStream = await navigator.mediaDevices.getUserMedia({
                    video: {
                        width: { ideal: 1280 },
                        height: { ideal: 720 },
                        facingMode: 'user'
                    },
                    audio: {
                        echoCancellation: true,
                        noiseSuppression: true,
                        sampleRate: 44100
                    }
                });

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ª–æ–∫–∞–ª—å–Ω–æ–µ –≤–∏–¥–µ–æ
                const localVideo = document.getElementById('localVideo');
                localVideo.srcObject = localStream;

                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
                document.getElementById('callStatus').textContent = '–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ';
                isCallActive = true;

                // –°–∏–º—É–ª—è—Ü–∏—è –æ—Ç–≤–µ—Ç–∞ –æ—Ç –¥—Ä—É–≥–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
                setTimeout(() => {
                    if (isCallActive) {
                        simulateRemoteVideo();
                        showNotification('–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ', 'success');
                    }
                }, 2000);

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–≤–æ–Ω–∫–∞:', error);
                document.getElementById('callStatus').textContent = '–û—à–∏–±–∫–∞: –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–º–µ—Ä–µ';
                showNotification('–†–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ –∏ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É', 'error');
                
                setTimeout(() => {
                    endCall();
                }, 3000);
            }
        }

        function simulateRemoteVideo() {
            const remoteVideo = document.getElementById('remoteVideo');
            
            // –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤–æ–µ –≤–∏–¥–µ–æ
            const canvas = document.createElement('canvas');
            canvas.width = 640;
            canvas.height = 480;
            const ctx = canvas.getContext('2d');

            // –ê–Ω–∏–º–∞—Ü–∏—è –¥–ª—è –∏–º–∏—Ç–∞—Ü–∏–∏ –≤–∏–¥–µ–æ
            function drawFrame() {
                if (!isCallActive) return;

                // –ì—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–π —Ñ–æ–Ω
                const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
                gradient.addColorStop(0, '#667eea');
                gradient.addColorStop(1, '#764ba2');
                ctx.fillStyle = gradient;
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                // –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                ctx.fillStyle = 'white';
                ctx.font = '48px Arial';
                ctx.textAlign = 'center';
                
                const chatInfo = getChatInfo(currentChat);
                ctx.fillText(chatInfo.avatar, canvas.width/2, canvas.height/2);

                // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º canvas –≤ stream
                const stream = canvas.captureStream(30);
                remoteVideo.srcObject = stream;

                requestAnimationFrame(drawFrame);
            }

            drawFrame();
        }

        function toggleAudio() {
            if (localStream) {
                const audioTrack = localStream.getAudioTracks()[0];
                if (audioTrack) {
                    audioTrack.enabled = !audioTrack.enabled;
                    isAudioMuted = !audioTrack.enabled;
                    
                    const btn = document.getElementById('toggleAudioBtn');
                    if (isAudioMuted) {
                        btn.classList.add('muted');
                        btn.innerHTML = '<i class="fas fa-microphone-slash"></i>';
                        showNotification('–ú–∏–∫—Ä–æ—Ñ–æ–Ω –≤—ã–∫–ª—é—á–µ–Ω', 'info');
                    } else {
                        btn.classList.remove('muted');
                        btn.innerHTML = '<i class="fas fa-microphone"></i>';
                        showNotification('–ú–∏–∫—Ä–æ—Ñ–æ–Ω –≤–∫–ª—é—á–µ–Ω', 'info');
                    }
                }
            }
        }

        function toggleVideo() {
            if (localStream) {
                const videoTrack = localStream.getVideoTracks()[0];
                if (videoTrack) {
                    videoTrack.enabled = !videoTrack.enabled;
                    isVideoOff = !videoTrack.enabled;
                    
                    const btn = document.getElementById('toggleVideoBtn');
                    if (isVideoOff) {
                        btn.classList.add('muted');
                        btn.innerHTML = '<i class="fas fa-video-slash"></i>';
                        showNotification('–ö–∞–º–µ—Ä–∞ –≤—ã–∫–ª—é—á–µ–Ω–∞', 'info');
                    } else {
                        btn.classList.remove('muted');
                        btn.innerHTML = '<i class="fas fa-video"></i>';
                        showNotification('–ö–∞–º–µ—Ä–∞ –≤–∫–ª—é—á–µ–Ω–∞', 'info');
                    }
                }
            }
        }

        function endCall() {
            isCallActive = false;
            
            // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –º–µ–¥–∏–∞–ø–æ—Ç–æ–∫–∏
            if (localStream) {
                localStream.getTracks().forEach(track => track.stop());
                localStream = null;
            }
            
            // –û—á–∏—â–∞–µ–º –≤–∏–¥–µ–æ
            document.getElementById('localVideo').srcObject = null;
            document.getElementById('remoteVideo').srcObject = null;
            
            // –°–∫—Ä—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –∑–≤–æ–Ω–∫–∞
            document.getElementById('callOverlay').classList.remove('active');
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
            isAudioMuted = false;
            isVideoOff = false;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏
            const audioBtn = document.getElementById('toggleAudioBtn');
            const videoBtn = document.getElementById('toggleVideoBtn');
            audioBtn.classList.remove('muted');
            audioBtn.innerHTML = '<i class="fas fa-microphone"></i>';
            videoBtn.classList.remove('muted');
            videoBtn.innerHTML = '<i class="fas fa-video"></i>';
            
            showNotification('–ó–≤–æ–Ω–æ–∫ –∑–∞–≤–µ—Ä—à–µ–Ω', 'info');
        }

        // ==================== –ü–†–û–§–ò–õ–¨ ====================
        function showProfileModal() {
            document.getElementById('profileModal').classList.add('active');
        }

        function hideProfileModal() {
            document.getElementById('profileModal').classList.remove('active');
        }

        function triggerAvatarUpload() {
            document.getElementById('avatarInput').click();
        }

        function handleAvatarUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            if (!file.type.startsWith('image/')) {
                showNotification('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ', 'error');
                return;
            }
            
            if (file.size > 5 * 1024 * 1024) {
                showNotification('–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –º–µ–Ω—å—à–µ 5MB', 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—ã–ª–∞ –±—ã –∑–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
                // –î–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –ø—Ä–æ—Å—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                showNotification('–ê–≤–∞—Ç–∞—Ä –±—É–¥–µ—Ç –∏–∑–º–µ–Ω–µ–Ω –ø–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è', 'info');
            };
            reader.readAsDataURL(file);
        }

        function saveProfile() {
            const name = document.getElementById('profileName').value.trim();
            const status = document.getElementById('profileStatus').value.trim();
            
            if (!name) {
                showNotification('–í–≤–µ–¥–∏—Ç–µ –∏–º—è', 'error');
                return;
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            userDB.updateUser(currentUser.id, {
                name: name,
                status: status
            });
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            currentUser = userDB.findUserById(currentUser.id);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º UI
            updateUserProfile();
            loadUserChats();
            
            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            hideProfileModal();
            
            showNotification('–ü—Ä–æ—Ñ–∏–ª—å –æ–±–Ω–æ–≤–ª–µ–Ω', 'success');
        }

        // ==================== –ù–ê–°–¢–†–û–ô–ö–ò ====================
        function showSettings() {
            document.getElementById('settingsPanel').classList.add('active');
        }

        function hideSettings() {
            document.getElementById('settingsPanel').classList.remove('active');
        }

        function changePassword() {
            const newPassword = prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å:');
            if (newPassword && newPassword.length >= 4) {
                userDB.updateUser(currentUser.id, { password: newPassword });
                showNotification('–ü–∞—Ä–æ–ª—å –∏–∑–º–µ–Ω–µ–Ω', 'success');
            } else if (newPassword) {
                showNotification('–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 4 —Å–∏–º–≤–æ–ª–æ–≤', 'error');
            }
        }

        function logout() {
            if (confirm('–í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞?')) {
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                userDB.updateUser(currentUser.id, { isOnline: false });
                
                // –û—á–∏—â–∞–µ–º —Å–µ—Å—Å–∏—é
                localStorage.removeItem('telegram_session');
                
                // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É
                location.reload();
            }
        }

        // ==================== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ====================
        function showChats() {
            document.getElementById('chatList').classList.remove('hidden');
            document.getElementById('channelList').classList.add('hidden');
            updateMenuActive('chats');
        }

        function showChannels() {
            document.getElementById('chatList').classList.add('hidden');
            document.getElementById('channelList').classList.remove('hidden');
            updateMenuActive('channels');
            renderChannels();
        }

        function renderChannels() {
            const channelList = document.getElementById('channelList');
            channelList.innerHTML = '';
            
            const channels = [
                { id: 'brat2', name: '–ë—Ä–∞—Ç 2', avatar: '–ë2', lastMessage: '–ö–ê–ö –¢–ê–ú –í–ê–®–ò –°–¢–ê–í–ö–ò –ù–ê –ö–õ–£...', time: '10:15', unread: 42 },
                { id: 'par', name: '–ü–∞—Ä', avatar: '–ü', lastMessage: '–ü–∞—Ä —Ç–µ–ø–µ—Ä—å –≤ Telegram', time: '–°—Ä', unread: 0 },
                { id: 'mama', name: '–ú–∞–º–∞', avatar: 'üë©', lastMessage: '–í—Å–µ —Ñ–∞–π–ª—ã –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ', time: '–ü–Ω', unread: 0 },
                { id: 'black_river', name: '–ß–µ—Ä–Ω–∞—è –†–µ—á–∫–∞ –ö–≤', avatar: 'üè†', lastMessage: '–ß–µ—Ä–Ω–∞—è –†–µ—á–∫–∞ –ö–≤ —Ç–µ–ø–µ—Ä—å –≤ Telegram', time: '25 –¥–µ–∫', unread: 0 }
            ];
            
            channels.forEach(channel => {
                const channelItem = document.createElement('div');
                channelItem.className = 'channel-item';
                
                channelItem.innerHTML = `
                    <div class="channel-avatar">${channel.avatar}</div>
                    <div class="chat-info">
                        <div class="chat-header">
                            <div class="chat-name">${channel.name}</div>
                            <div class="chat-time">${channel.time}</div>
                        </div>
                        <div class="chat-preview">
                            <div class="chat-preview-text">${channel.lastMessage}</div>
                            ${channel.unread > 0 ? `<div class="chat-unread">${channel.unread}</div>` : ''}
                        </div>
                    </div>
                `;
                
                channelList.appendChild(channelItem);
            });
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –±–µ–π–¥–∂ –∫–∞–Ω–∞–ª–æ–≤
            const totalUnread = channels.reduce((sum, channel) => sum + channel.unread, 0);
            document.getElementById('channelBadge').textContent = totalUnread;
        }

        function updateMenuActive(activeItem) {
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
            });
            
            const items = {
                'chats': 0,
                'channels': 1,
                'settings': 2
            };
            
            if (items[activeItem] !== undefined) {
                document.querySelectorAll('.menu-item')[items[activeItem]].classList.add('active');
            }
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('active');
        }

        function searchChats() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            const chatItems = document.querySelectorAll('.chat-item');
            
            chatItems.forEach(item => {
                const chatName = item.querySelector('.chat-name').textContent.toLowerCase();
                if (chatName.includes(query)) {
                    item.style.display = 'flex';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        function startNewChat() {
            const otherUsers = userDB.getAllUsersExcept(currentUser.id);
            
            if (otherUsers.length === 0) {
                showNotification('–ù–µ—Ç –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π', 'info');
                return;
            }
            
            // –°–æ–∑–¥–∞–µ–º —á–∞—Ç —Å –ø–µ—Ä–≤—ã–º –¥–æ—Å—Ç—É–ø–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
            const otherUser = otherUsers[0];
            let chat = chatSystem.getChatBetweenUsers(currentUser.id, otherUser.id);
            
            if (!chat) {
                chat = chatSystem.createPrivateChat(currentUser.id, otherUser.id);
            }
            
            selectChat(chat);
            showNotification(`–ù–∞—á–∞—Ç —á–∞—Ç —Å ${otherUser.name}`, 'success');
        }

        function attachFile() {
            showNotification('–§—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ', 'info');
        }

        function updateUnreadBadge() {
            if (!currentUser) return;
            
            const userChats = chatSystem.getChatsForUser(currentUser.id);
            let totalUnread = 0;
            
            userChats.forEach(chat => {
                totalUnread += chatSystem.getUnreadCount(chat.id, currentUser.id);
            });
            
            document.getElementById('unreadBadge').textContent = totalUnread;
        }

        function adjustTextareaHeight(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = Math.min(textarea.scrollHeight, 120) + 'px';
        }

        // ==================== –°–ï–†–í–ï–† ====================
        function connectToServer() {
            // –ò–º–∏—Ç–∞—Ü–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É
            showNotification('–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É...', 'info');
            
            setTimeout(() => {
                showNotification('–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ', 'success');
                
                // –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
                setInterval(() => {
                    if (currentUser) {
                        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                        updateUserStatuses();
                        
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
                        checkForNewMessages();
                    }
                }, 30000); // –ö–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
            }, 2000);
        }

        function updateUserStatuses() {
            // –°–ª—É—á–∞–π–Ω—ã–º –æ–±—Ä–∞–∑–æ–º –º–µ–Ω—è–µ–º —Å—Ç–∞—Ç—É—Å—ã –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
            const otherUsers = userDB.getAllUsersExcept(currentUser.id);
            otherUsers.forEach(user => {
                if (Math.random() > 0.7) {
                    const wasOnline = user.isOnline;
                    user.isOnline = Math.random() > 0.3;
                    
                    if (wasOnline !== user.isOnline) {
                        userDB.updateUser(user.id, { isOnline: user.isOnline });
                        
                        // –û–±–Ω–æ–≤–ª—è–µ–º UI –µ—Å–ª–∏ —á–∞—Ç —Å —ç—Ç–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –æ—Ç–∫—Ä—ã—Ç
                        if (currentChat) {
                            const chatInfo = getChatInfo(currentChat);
                            if (chatInfo.id === user.id) {
                                updateChatUI();
                            }
                        }
                        
                        // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤
                        loadUserChats();
                    }
                }
            });
        }

        function checkForNewMessages() {
            if (!currentUser) return;
            
            const userChats = chatSystem.getChatsForUser(currentUser.id);
            let hasNewMessages = false;
            
            userChats.forEach(chat => {
                const unreadCount = chatSystem.getUnreadCount(chat.id, currentUser.id);
                if (unreadCount > 0) {
                    hasNewMessages = true;
                }
            });
            
            if (hasNewMessages) {
                updateUnreadBadge();
            }
        }

        // ==================== –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø ====================
        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            const title = document.getElementById('notificationTitle');
            const body = document.getElementById('notificationBody');
            
            body.textContent = message;
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ü–≤–µ—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞
            if (type === 'error') {
                title.innerHTML = '‚ö†Ô∏è –û—à–∏–±–∫–∞';
            } else if (type === 'success') {
                title.innerHTML = '‚úÖ –£—Å–ø–µ—à–Ω–æ';
            } else {
                title.innerHTML = '‚ÑπÔ∏è Telegram';
            }
            
            notification.classList.add('active');
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∫—Ä—ã—Ç–∏–µ
            setTimeout(() => {
                notification.classList.remove('active');
            }, 3000);
        }

        function hideNotification() {
            document.getElementById('notification').classList.remove('active');
        }

        // ==================== –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –°–û–ë–´–¢–ò–ô ====================
        function setupEventListeners() {
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –≤—ã—Å–æ—Ç—ã textarea
            const messageInput = document.getElementById('messageInput');
            messageInput.addEventListener('input', function() {
                adjustTextareaHeight(this);
            });

            // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ Enter (–±–µ–∑ Shift)
            messageInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });

            // –ó–∞–∫—Ä—ã—Ç–∏–µ –∑–≤–æ–Ω–∫–∞ –ø–æ Escape
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && isCallActive) {
                    endCall();
                }
            });

            // –ê–¥–∞–ø—Ç–∞—Ü–∏—è –∫ –º–æ–±–∏–ª—å–Ω—ã–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º
            window.addEventListener('resize', function() {
                if (window.innerWidth > 768) {
                    document.getElementById('sidebar').classList.remove('active');
                }
            });
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
        setupEventListeners();
    </script>
</body>
</html>
